# v1.0.2.4

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**1.0.2.4**] - 2026-01-01

Major infrastructure release with critical bug fixes, security hardening, MCP install automation, and comprehensive codebase standardization across 70+ files. Adds sub-agent delegation for token efficiency and universal stack-agnostic debugging.

---

### Fixed

**Critical**

1. **SQLite Transaction Nesting** — Error in `memory_index_scan` - `indexMemory()` now uses composable `database.transaction()` wrapper
2. **Race Condition** — Database changes weren't visible across MCP/script connections - added file-based notification with `reinitializeDatabase()`
3. **Orphaned Metadata** — Failed vector insertions leaving orphaned metadata - explicit transaction control with rollback

**High**

4. **Wrong Dimensions** — Schema created with wrong embedding dimensions before provider warmup - `getConfirmedEmbeddingDimension()` with polling
5. **Cache Invalidation** — Constitutional cache didn't invalidate on external database edits - mtime tracking added
6. **Rate Limiting** — State lost on server restart - persistent `config` table in SQLite
7. **Stale Statements** — Stale prepared statements after database reset - `clearPreparedStatements()` in reset paths
8. Query validation for whitespace-only/empty/null inputs
9. UTF-8 BOM (EF BB BF) detection in memory parser
10. Cache key collision risk - SHA256 hash-based keys
11. Non-interactive mode silently using defaults - now fails with guidance
12. Orphaned vectors never auto-cleaned - `verifyIntegrity({ autoClean: true })`

---

### Security

1. **CWE-22** — Path traversal protection in CLI `CONFIG.DATA_FILE` and DB-stored paths
2. **CWE-400** — Input length limits for MCP tool parameters (query 10K, title 500, paths 500 chars)
3. MEDIUM severity issues reduced from 4 to 1

---

### New

1. **MCP Install Scripts Suite** — Shell-based installers for all 6 MCP servers with shared utilities library (33 functions)
2. **Sub-agent Delegation** — `/spec_kit:handover` and `/memory:save` now delegate heavy work to sub-agents for token efficiency
3. **Session Behavior Modes** — `--brief`, `--verbose`, `--debug` flags for controlling response verbosity
4. **Universal Debugging** — Stack-agnostic 4-phase approach (Observe → Analyze → Hypothesize → Fix) with new reference doc
5. **Auto/Confirm Modes** — 6 `/create` commands now support `:auto` and `:confirm` mode flags
6. **Research Chaining** — `/spec_kit:complete` supports `:with-research` and `:auto-debug` flags
7. Configurable scoring weights for smart ranking (`smartRanking.recencyWeight`)
8. Configurable trigger phrase limit via `maxTriggersPerMemory`
9. Plain-language gates (~50+ "STOP HERE - Wait for X" markers) in 16 command files
10. "What Next?" navigation tables in 14 commands
11. Confidence checkpoints in 9 YAML workflow files

---

### Changed

1. **References Reorganized** — 18 files moved from flat structure into 7 logical sub-folders (`config/`, `debugging/`, `memory/`, `structure/`, `templates/`, `validation/`, `workflows/`)
2. **79 Internal Links Fixed** across reference documentation
3. **Lib Consolidation** — Shared modules centralized in `lib/` folder with re-export wrappers
4. **Asset Template Alignment** — 9 asset files standardized across 6 skill folders
5. **workflows-code Skill** — Priority-based resource loading (P1/P2/P3), references reorganized into 5 sub-folders
6. **Code Style Alignment** — 70 files standardized with snake_case naming, 3-line box-drawing headers, ~3,900 lines metadata removed
7. `/spec_kit:debug` made stack-agnostic - removed frontend-specific tool references
8. `implementation-summary.md` now required for all spec levels
9. Template priority standardized to P0/P1/P2 only

**Full Changelog**: [v1.0.2.3...v1.0.2.4](https://github.com/MichelKerkmeester/opencode-spec-kit-framework/compare/v1.0.2.3...v1.0.2.4)

---

*For full release history, see the [global CHANGELOG](../CHANGELOG.md).*
