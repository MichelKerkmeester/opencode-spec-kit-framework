# v1.0.2.1

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**1.0.2.1**] - 2025-12-31

Comprehensive system hardening release with critical bug fixes, security improvements, and performance optimizations for the Spec Kit Memory system.

---

### Fixed

**Critical**

1. **Embedding Dimension Mismatch** — Checkpoints now use dynamic dimension detection instead of hardcoded 768, fixing failures with Voyage (1024) and OpenAI (1536) providers
2. **Dimension Detection** — `getEmbeddingDimension()` now correctly detects dimension from provider, environment variables, or API keys before falling back to default

**High**

3. Memory indexing failures caused by dimension validation mismatches
4. Empty catch blocks that silently swallowed errors (2 fixed with proper logging)
5. Blocking file I/O replaced with async `fs.promises.readFile`
6. Stale documentation references to deleted files
7. Architecture diagram showing incorrect folder paths
8. Version inconsistencies in context-server.js (now 16.0.0)

---

### New

1. **Embedding Cache** — LRU cache (1000 entries) reduces redundant API calls
2. **Shared Utilities** — `shared/utils.js` consolidated `validateFilePath` and `escapeRegex` utilities
3. **Parallel Embeddings** — 3-5x faster with configurable concurrency (default: 5)
4. **Test Fixtures** — 37 files across 10 folders for validation testing
5. **Unicode Normalization** — Improved trigger phrase matching
6. **Constitutional Scanning** — Auto-scanning in `memory_index_scan`
7. **Dry Run** — `dryRun` parameter for `memory_delete` to preview before executing
8. **New Validation Scripts** — `check-folder-naming.sh`, `check-frontmatter.sh`
9. **Help Flag** — `--help` flag for `generate-context.js`
10. **Tool Documentation** — 8 missing MCP tools documented in SKILL.md (now 14 total)

---

### Changed

1. **Lib Consolidation** — Shared modules moved to `shared/` folder with re-export wrappers for backward compatibility
2. All hardcoded paths now use environment variables for portability
3. Deprecated JS validators removed (bash validators preferred)
4. Template metadata formats standardized

---

### Security

1. **CWE-22** — Added path validation to CLI `CONFIG.DATA_FILE`
2. **CWE-22** — Added `validateFilePath()` checks for DB-stored paths
3. **CWE-400** — Added input length limits to MCP handler parameters
4. Removed personal path references from public release
5. Fixed symlinks pointing to personal directories

**Full Changelog**: [v1.0.2.0...v1.0.2.1](https://github.com/MichelKerkmeester/opencode-spec-kit-framework/compare/v1.0.2.0...v1.0.2.1)

---

*For full release history, see the [global CHANGELOG](../CHANGELOG.md).*
