# v1.0.6.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**1.0.6.0**] - 2026-01-21

Major template architecture overhaul introducing CORE + ADDENDUM v2.0. This release achieves 74-82% template line reduction through a compositional model, adds 26 verbose templates with extended guidance for new users, creates a comprehensive 557-test validation suite, and standardizes all 19 commands across 4 namespaces. The result: templates that add genuine value at each documentation level instead of boilerplate, with full backward compatibility. Implements specs 073-076.

---

### New

**CORE + ADDENDUM v2.0 Template Architecture (Spec 073)**

1. **Compositional Template Model** â€” Monolithic templates replaced with modular core + addendum architecture:
   - `templates/core/`: 4 base templates (322 LOC total)
     - `spec-core.md` (94 lines) â€” Essential what/why/how
     - `plan-core.md` (102 lines) â€” Technical approach and phases
     - `tasks-core.md` (67 lines) â€” Task breakdown with notation
     - `impl-summary-core.md` (59 lines) â€” Post-implementation summary
   - `templates/addendum/level2-verify/`: Verification sections (184 LOC)
     - `spec-level2.md` â€” NFRs, Edge Cases, Complexity Assessment
     - `plan-level2.md` â€” Phase Dependencies, Effort Estimates
     - `checklist.md` â€” QA verification with P0/P1/P2 priorities
   - `templates/addendum/level3-arch/`: Architecture sections (220 LOC)
     - `spec-level3.md` â€” Executive Summary, Risk Matrix, User Stories
     - `plan-level3.md` â€” Dependency Graph, Critical Path, Milestones
     - `decision-record.md` â€” ADR template with alternatives matrix
   - `templates/addendum/level3plus-govern/`: Governance sections (190 LOC)
     - `spec-level3plus.md` â€” Approval Workflow, Compliance, Stakeholder Matrix
     - `plan-level3plus.md` â€” AI Execution Framework, Workstream Coordination
     - `checklist-extended.md` â€” Extended checklist with approval workflow
2. **Value-Based Level Scaling** â€” Each level adds distinct VALUE sections (not boilerplate):
   - Level 1 (Core): Essential what/why/how â€” 4 files, ~320 lines
   - Level 2 (+Verify): +NFRs, +Edge Cases, +Complexity Score, +Effort Estimates â€” 5 files, ~520 lines
   - Level 3 (+Arch): +Executive Summary, +Risk Matrix, +User Stories, +ADRs, +Milestones â€” 6 files, ~760 lines
   - Level 3+ (+Govern): +Approval Workflow, +Compliance Checkpoints, +Stakeholder Matrix, +AI Framework â€” 6 files, ~950 lines
3. **Workstream Notation** â€” Prefixes for parallel sub-agent coordination in multi-agent scenarios:
   - `[W-A]`, `[W-B]`, `[W-C]` â€” Workstream ownership markers
   - `[SYNC]` â€” Synchronization points requiring coordination
   - Enables 40% faster spec creation via parallelization (Tier 2 parallel, Tier 3 integration)
4. **Pre-Composed Level Templates** â€” Ready-to-use templates in `templates/level_N/` directories:
   - `templates/level_1/` â€” Core only (4 files)
   - `templates/level_2/` â€” Core + L2 addendums (5 files)
   - `templates/level_3/` â€” Core + L2 + L3 addendums (6 files)
   - `templates/level_3+/` â€” All addendums combined (6 files)
5. **Architecture Decision Records** â€” Three ADRs documenting design decisions:
   - ADR-001: CORE + ADDENDUM architecture (single source of truth, modular maintenance)
   - ADR-002: Value-based level scaling (real usage analysis showed 0% usage of stakeholders, traceability mapping, KPI targets)
   - ADR-003: Workstream notation standard (enables clear task coordination in multi-agent scenarios)

**Verbose Templates (Spec 074)**

6. **26 Verbose Template Files** â€” Extended guidance scaffolding in `templates/verbose/` for new users:
   - `verbose/core/`: spec-core-verbose.md (201 lines), plan-core-verbose.md (246 lines), tasks-core-verbose.md (210 lines), impl-summary-core-verbose.md (169 lines)
   - `verbose/level_1/` through `verbose/level_3+/`: Pre-composed verbose templates at each level
   - ~2.5-3x longer than minimal templates (~200-300 lines vs ~60-90 lines)
7. **Three Guidance Patterns** â€” Structured scaffolding for template completion:
   - `[YOUR_VALUE_HERE: description]` â€” Placeholders with contextual guidance (e.g., `[YOUR_VALUE_HERE: 1 for <100 LOC, 2 for 100-499 LOC, 3 for 500+ LOC]`)
   - `[NEEDS CLARIFICATION: (a) (b) (c)]` â€” Multiple-choice questions for ambiguous requirements
   - `[example: specific content]` â€” Inline examples demonstrating expected quality
   - Verbose-only sections: ASSUMPTIONS (spec), COMPLEXITY JUSTIFICATION (plan)
8. **SPECKIT_TEMPLATE_STYLE Environment Variable** â€” Switch between template variants:
   ```bash
   export SPECKIT_TEMPLATE_STYLE=verbose  # Extended guidance for new users
   export SPECKIT_TEMPLATE_STYLE=minimal  # Clean templates for experienced users (default)
   ```
9. **compose.sh Script** â€” 1,021-line automated template composition and maintenance tool:
   - Location: `scripts/templates/compose.sh`
   - Usage: `./compose.sh --level 2` to regenerate level 2 templates from core + addendums
   - Supports `--all` flag to regenerate all levels
   - Includes `--dry-run` for preview without changes
10. **WHEN TO USE Sections** â€” HTML comments in 8 template files for invisible guidance:
    ```html
    <!-- WHEN TO USE: Level 1 for features <100 LOC with clear requirements -->
    ```
    - Visible during editing, invisible in rendered output
    - Added to all spec.md and plan.md templates across levels

**Test Suite (Spec 075)**

11. **test-template-system.js** â€” 95 tests covering template validation:
    - Core template validation and composition verification
    - SPECKIT_LEVEL marker detection
    - Verbose template guidance pattern validation
    - Template path resolution
12. **test-validation-extended.sh** â€” 129 tests for all 14 validation rules:
    - Exit code semantics (0=pass, 1=warn, 2=error)
    - JSON/verbose/quiet output modes
    - Path-scoped validation
    - All rules: FILE_EXISTS, FOLDER_NAMING, FRONTMATTER_VALID, PRIORITY_TAGS, EVIDENCE_CITED, PLACEHOLDER_FILLED, ANCHORS_VALID, SECTIONS_PRESENT, LEVEL_DECLARED, COMPLEXITY_MATCH, SECTION_COUNTS, AI_PROTOCOL, LEVEL_MATCH
13. **test-mcp-tools.js** â€” 148 tests for MCP tool functionality:
    - Memory search (semantic matching, anchor filtering, folder-scoped queries)
    - `memory_match_triggers` pattern detection
    - Checkpoint operations (create/list/restore/delete)
    - Memory CRUD operations
14. **test-scripts-modules.js** â€” 166 tests for script modules:
    - `generate-context.js` (JSON/folder input modes, ANCHOR format)
    - Extractors module (file, conversation, decision, diagram)
    - Utils module (path, validation, input normalization)
    - Lib module (embedding-client, sqlite-client, index-manager, search-engine)
15. **test-integration.js** â€” 36 end-to-end workflow tests:
    - Full memory save workflow
    - Complete validation pipeline
    - Cognitive memory session flow
    - Checkpoint roundtrip testing

---

### Changed

**Command Standardization (Specs 075-076)**

1. **19 Commands Aligned** â€” Section headers standardized across all 4 namespaces:
   - **spec_kit/** (7): `complete.md`, `debug.md`, `handover.md`, `implement.md`, `plan.md`, `research.md`, `resume.md`
   - **memory/** (3): `database.md`, `save.md`, `search.md`
   - **create/** (6): `folder_readme.md`, `install_guide.md`, `skill.md`, `skill_asset.md`, `skill_reference.md`, `agent.md`
   - **search/** (2): `code.md`, `index.md`
2. **Section Header Migration** â€” `ðŸ”œ WHAT NEXT?` â†’ `ðŸ“Œ NEXT STEPS` per approved emoji vocabulary:
   - `ðŸ”œ` emoji not in approved vocabulary; `ðŸ“Œ` already approved for REFERENCE/NOTES sections
   - Parenthetical text removed from H2 headers (e.g., `WORKFLOW OVERVIEW (9 STEPS)` â†’ `WORKFLOW OVERVIEW`)
3. **OUTPUT FORMATS Sections** â€” Added explicit output format documentation to 4 spec_kit commands:
   - `complete.md`, `implement.md`, `plan.md`, `research.md`
   - Improves discoverability; matches existing pattern in `debug.md` and `handover.md`
4. **Mandatory Gate for `/memory:search`** â€” 33-line multi-phase blocking gate:
   - Requires `<id>` or `<spec-folder>` argument before proceeding
   - 4 search mode options: by ID, by spec folder, recent memories, semantic search
   - Prevents context inference errors from missing required arguments
5. **Frontmatter Argument Format** â€” Required arguments now use angle brackets:
   - `/create:skill`: `skill-name` â†’ `<skill-name>`
   - `/create:agent`: `agent-name` â†’ `<agent-name>`
   - Aligns with command_template.md standard for required vs optional args

**YAML Asset Updates (Spec 076)**

6. **spec_kit YAMLs** â€” 4 files updated with version and template references:
   - `spec_kit_plan_auto.yaml`, `spec_kit_plan_confirm.yaml`: Version v1.9.0, Level 1 files now include `implementation-summary.md`
   - `spec_kit_implement_auto.yaml`, `spec_kit_implement_confirm.yaml`: Version v1.9.0
7. **resume YAMLs** â€” Anchor-based memory retrieval for ~90% token efficiency:
   - `spec_kit_resume_auto.yaml`, `spec_kit_resume_confirm.yaml`
   - Uses `anchors: ['summary', 'state', 'next-steps']` for targeted retrieval
8. **research YAMLs** â€” Enhanced configuration:
   - `spec_kit_research_auto.yaml`: Version v1.9.0, generate-context.js rule
   - `spec_kit_research_confirm.yaml`: 17-section enumeration for comprehensive coverage
9. **create_agent.yaml** â€” Deep restructure for clarity:
   - Terminology: "subagent" â†’ "secondary" (9 locations)
   - Unified permission format across auto/confirm modes
   - Added execution mode headers

**Template System**

10. **74-82% Template Line Reduction** â€” Unused sections removed based on real usage analysis of 9+ spec folders:
    - Removed: Stakeholders (0% usage), Traceability Mapping (0% usage), KPI Targets (0% usage), Given/When/Then (10% usage), Assumptions Validation (5% usage)
    - Result: L1 from ~800 to ~320 lines, L3 from ~2,100 to ~760 lines
11. **Template Path Conventions** â€” `templates/level_N/` is canonical location:
    - Clarified from earlier `composed/` references in documentation
    - 12 occurrences corrected in SKILL.md
    - Template path table added to SKILL.md
12. **implementation-summary.md Required at Level 1** â€” Previously implicit, now explicit requirement:
    - Created after implementation completes, not at spec folder creation
    - Added to Level 1 required files in `spec_kit_plan_*.yaml`

**Infrastructure**

13. **Documentation Aligned to write.md Standards** â€” 12 documentation files now 100% compliant:
    - Section 1 renamed to OVERVIEW (was various names)
    - RELATED RESOURCES section added as final section
    - Sequential numbering fixed in asset files
14. **Version Bump** â€” system-spec-kit v1.9.0 â†’ v2.0.0 reflecting major architectural change

---

### Fixed

**Template Fixes**

1. **Level 2 Template Composition** â€” Corrected composition issues where L2 templates were missing addendum sections
2. **6 Orphaned COMPLEXITY_GATE Markers** â€” Removed from `templates/level_2/checklist.md` (deprecated markers from previous architecture)
3. **Template Version Markers** â€” Added `v2.0` to SPECKIT_TEMPLATE_SOURCE in all templates

**Script Fixes**

4. **create.sh Uninitialized Variables** â€” Fixed variable initialization issues causing script failures
5. **Validation Script grep Pipeline** â€” Added `|| true` pattern for `set -eo pipefail` compatibility:
   - `grep` returns exit code 1 when no matches found
   - Scripts now handle no-match case gracefully
6. **Non-Portable Regex** â€” Fixed regex patterns for cross-platform compatibility (macOS + Linux)

**Cross-Platform**

7. **macOS /tmp Path Security** â€” Added `/tmp` and `/private/tmp` to allowedBases in `scripts/loaders/data-loader.js`:
   - macOS `/tmp` symlinks to `/private/tmp`
   - Both paths now accepted for cross-platform compatibility

**Documentation**

8. **Cross-Reference Fix** â€” `/memory:database` line 404 corrected to reference `/memory:checkpoint restore` (was incorrectly referencing `/memory:database restore`)
9. **Path Reference Updates** â€” 36 documentation paths updated to reflect new template structure

---

### Verification

- **557 tests**: 540 passed, 17 skipped, 0 failures (97% pass rate)
- **P0 Critical Tests**: 100% passing (core initialization, MCP server, database, vector search)
- **P1 Required Tests**: 100% passing (validation rules, cognitive features, memory generation)
- **Template Composition**: `compose.sh` generates identical output to pre-composed templates
- **Cross-Platform**: macOS and Linux path handling verified
- **Backward Compatibility**: All existing spec folders function without modification

---

### Upgrade

1. **Restart Required** â€” Restart OpenCode to load updated templates and command definitions
2. **Template Selection** â€” Choose template variant based on experience level:
   ```bash
   # For new users (extended guidance)
   export SPECKIT_TEMPLATE_STYLE=verbose

   # For experienced users (clean templates, default)
   export SPECKIT_TEMPLATE_STYLE=minimal
   ```
3. **Compose Script** â€” Regenerate level templates if customizing core templates:
   ```bash
   cd .opencode/skill/system-spec-kit/scripts/templates
   ./compose.sh --all          # Regenerate all levels
   ./compose.sh --level 2      # Regenerate specific level
   ./compose.sh --dry-run      # Preview without changes
   ```
4. **No Breaking Changes** â€” All existing spec folders and APIs maintain backward compatibility:
   - Existing `templates/level_N/` paths continue to work
   - Memory system unchanged
   - Validation rules unchanged (all 51 test fixtures pass)
5. **Optional Migration** â€” To use verbose templates for existing incomplete specs:
   - Copy verbose templates: `cp templates/verbose/level_2/* specs/###-feature/`
   - Fill in guidance patterns, then simplify to core format

**Full Changelog**: [v1.0.5.0...v1.0.6.0](https://github.com/MichelKerkmeester/opencode-spec-kit-framework/compare/v1.0.5.0...v1.0.6.0)

---

*For full release history, see the [global CHANGELOG](../CHANGELOG.md).*
