<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">
<title>CI/CD Pipeline â€” Reference Template</title>
<!--
  Reference template for the sk-visual-explainer skill: Mermaid diagrams.
  Uses the shared SpecKit dashboard palette (single approved palette for all templates).
  Key patterns demonstrated:
  - Shared visual-explainer palette consistency
  - Dot-grid background atmosphere (different from radial gradient)
  - Large heading (38px) for typographic contrast
  - ESM import of Mermaid + @mermaid-js/layout-elk
  - Mermaid theme: 'base' + full themeVariables, fontSize: 16px
  - CSS overrides: .nodeLabel 16px, .edgeLabel 13px
  - look: 'handDrawn' for sketchy aesthetic (toggle to 'classic')
  - layout: 'elk' for better node positioning
  - Zoom controls with scroll-to-zoom and drag-to-pan
  - Both light and dark themes via prefers-color-scheme
  - Staggered fade-in, reduced motion respect
-->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@400;500;600;700&family=Fragment+Mono:wght@400&display=swap" rel="stylesheet">
<style>
  /* ============ THEME ============ */
  :root {
    --font-body: 'Bricolage Grotesque', system-ui, sans-serif;
    --font-mono: 'Fragment Mono', 'SF Mono', Consolas, monospace;

    --ve-bg: #f7fafc;
    --ve-surface: #ffffff;
    --ve-surface2: #eef3f8;
    --ve-surface-elevated: #fcfdff;
    --ve-border: rgba(15, 23, 42, 0.1);
    --ve-border-bright: rgba(15, 23, 42, 0.2);
    --ve-text: #0f172a;
    --ve-text-dim: #4b5563;

    --ve-accent: #0f766e;
    --ve-accent-dim: rgba(15, 118, 110, 0.1);
    --ve-success: #15803d;
    --ve-success-dim: rgba(21, 128, 61, 0.1);
    --ve-warning: #b45309;
    --ve-warning-dim: rgba(180, 83, 9, 0.1);
    --ve-danger: #b91c1c;
    --ve-danger-dim: rgba(185, 28, 28, 0.1);

    --ve-primary: var(--ve-accent);
    --ve-primary-dim: var(--ve-accent-dim);
    --ve-secondary: var(--ve-success);
    --ve-secondary-dim: var(--ve-success-dim);
    --ve-tertiary: var(--ve-warning);
    --ve-tertiary-dim: var(--ve-warning-dim);
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --ve-bg: #071017;
      --ve-surface: #10202a;
      --ve-surface2: #162b37;
      --ve-surface-elevated: #1a3240;
      --ve-border: rgba(226, 232, 240, 0.14);
      --ve-border-bright: rgba(226, 232, 240, 0.24);
      --ve-text: #e5edf5;
      --ve-text-dim: #a9b6c3;

      --ve-accent: #2dd4bf;
      --ve-accent-dim: rgba(45, 212, 191, 0.16);
      --ve-success: #4ade80;
      --ve-success-dim: rgba(74, 222, 128, 0.16);
      --ve-warning: #fbbf24;
      --ve-warning-dim: rgba(251, 191, 36, 0.16);
      --ve-danger: #f87171;
      --ve-danger-dim: rgba(248, 113, 113, 0.16);
    }
  }

  @media (prefers-contrast: more) {
    :root {
      --ve-border: rgba(0, 0, 0, 0.3);
      --ve-border-bright: rgba(0, 0, 0, 0.45);
      --ve-text-dim: #334155;
    }
  }

  @media (forced-colors: active) {
    :root {
      --ve-bg: Canvas;
      --ve-surface: Canvas;
      --ve-surface2: Canvas;
      --ve-border: CanvasText;
      --ve-border-bright: CanvasText;
      --ve-text: CanvasText;
      --ve-text-dim: CanvasText;
      --ve-accent: LinkText;
      --ve-success: CanvasText;
      --ve-warning: CanvasText;
      --ve-danger: CanvasText;
    }
  }

  /* ============ RESET + BASE ============ */
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background-color: var(--ve-bg);
    background-image: radial-gradient(circle, var(--ve-border) 1px, transparent 1px);
    background-size: 24px 24px;
    color: var(--ve-text);
    font-family: var(--font-body);
    padding: 40px;
    min-height: 100vh;
  }

  /* ============ ANIMATION ============ */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .animate {
    animation: fadeUp 0.4s ease-out both;
    animation-delay: calc(var(--i, 0) * 0.06s);
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-delay: 0ms !important;
      transition-duration: 0.01ms !important;
    }
    .mermaid-wrap .mermaid { transition: none; }
  }

  /* ============ LAYOUT ============ */
  .container {
    max-width: 1000px;
    margin: 0 auto;
  }

  h1 {
    font-size: 38px;
    font-weight: 700;
    letter-spacing: -1px;
    margin-bottom: 6px;
    text-wrap: balance;
  }

  .subtitle {
    color: var(--ve-text-dim);
    font-family: var(--font-mono);
    font-size: 12px;
    margin-bottom: 32px;
  }

  .description {
    font-size: 14px;
    line-height: 1.7;
    color: var(--ve-text-dim);
    margin-bottom: 24px;
    max-width: 700px;
  }

  .description code {
    font-family: var(--font-mono);
    font-size: 12px;
    background: var(--ve-primary-dim);
    color: var(--ve-primary);
    padding: 1px 5px;
    border-radius: 3px;
  }

  /* ============ MERMAID CONTAINER ============ */
  .mermaid-wrap {
    position: relative;
    background: var(--ve-surface);
    border: 1px solid var(--ve-border);
    border-radius: 12px;
    padding: 32px 24px;
    overflow: auto;
    margin-bottom: 24px;
  }

  .mermaid-wrap .mermaid {
    display: flex;
    justify-content: center;
    transition: transform 0.2s ease;
    transform-origin: top center;
  }

  .zoom-controls {
    position: absolute;
    top: 8px;
    right: 8px;
    display: flex;
    gap: 2px;
    z-index: 10;
    background: var(--ve-surface);
    border: 1px solid var(--ve-border);
    border-radius: 6px;
    padding: 2px;
  }

  .zoom-controls button {
    width: 28px;
    height: 28px;
    border: none;
    background: transparent;
    color: var(--ve-text-dim);
    font-family: var(--font-mono);
    font-size: 14px;
    cursor: pointer;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s ease, color 0.15s ease;
  }

  .zoom-controls button:hover {
    background: var(--ve-border);
    color: var(--ve-text);
  }

  .mermaid-wrap {
    scrollbar-width: thin;
    scrollbar-color: var(--ve-border) transparent;
  }
  .mermaid-wrap::-webkit-scrollbar { width: 6px; height: 6px; }
  .mermaid-wrap::-webkit-scrollbar-track { background: transparent; }
  .mermaid-wrap::-webkit-scrollbar-thumb {
    background: var(--ve-border);
    border-radius: 3px;
  }
  .mermaid-wrap::-webkit-scrollbar-thumb:hover { background: var(--ve-text-dim); }

  .mermaid-wrap.is-zoomed { cursor: grab; }
  .mermaid-wrap.is-panning { cursor: grabbing; user-select: none; }

  /* ============ MERMAID SVG OVERRIDES ============ */
  .mermaid .nodeLabel {
    font-family: var(--font-body) !important;
    font-size: 16px !important;
  }

  .mermaid .edgeLabel {
    font-family: var(--font-mono) !important;
    font-size: 13px !important;
  }

  .mermaid .node rect,
  .mermaid .node circle,
  .mermaid .node polygon {
    stroke-width: 1.5px !important;
  }

  .mermaid .edge-pattern-solid {
    stroke-width: 1.5px !important;
  }

  /* ============ LEGEND ============ */
  .legend {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--ve-text-dim);
  }

  .legend-swatch {
    width: 12px;
    height: 12px;
    border-radius: 3px;
  }

  /* ============ CALLOUT ============ */
  .callout {
    background: var(--ve-surface);
    border: 1px solid var(--ve-border);
    border-left: 3px solid var(--ve-primary);
    border-radius: 0 10px 10px 0;
    padding: 16px 20px;
    font-size: 13px;
    line-height: 1.6;
    color: var(--ve-text-dim);
    margin-top: 24px;
  }

  .callout strong { color: var(--ve-text); }

  .callout code {
    font-family: var(--font-mono);
    font-size: 11px;
    background: var(--ve-primary-dim);
    color: var(--ve-primary);
    padding: 1px 5px;
    border-radius: 3px;
  }

  /* ============ RESPONSIVE ============ */
  @media (max-width: 768px) {
    body { padding: 16px; }
    h1 { font-size: 22px; }
    .mermaid-wrap { padding: 16px 12px; }
  }
</style>
</head>
<body>

<main class="container" role="main">

  <header>
    <h1 class="animate" style="--i:0">CI/CD Pipeline</h1>
    <p class="subtitle animate" style="--i:1">github actions &rarr; staging &rarr; production</p>
  </header>

  <p class="description animate" style="--i:2">
    Every push to <code>main</code> triggers the full pipeline. Tests and linting run in parallel,
    then the build step produces a Docker image. Staging deploys automatically; production requires
    manual approval via a GitHub environment gate.
  </p>

  <figure class="mermaid-wrap animate" style="--i:3">
    <div class="zoom-controls">
      <button onclick="zoomDiagram(this, 1.2)" title="Zoom in" aria-label="Zoom in">+</button>
      <button onclick="zoomDiagram(this, 0.8)" title="Zoom out" aria-label="Zoom out">&minus;</button>
      <button onclick="resetZoom(this)" title="Reset zoom" aria-label="Reset zoom">&#8634;</button>
    </div>
    <pre class="mermaid">
      graph TD
        A[Push to main] --> B{Branch?}
        B -->|main| C[Run Tests]
        B -->|feature| I[Run Tests]
        I --> J[Preview Deploy]
        C --> D[Lint + Type Check]
        C --> E[Unit Tests]
        C --> F[Integration Tests]
        D --> G[Build Docker Image]
        E --> G
        F --> G
        G --> H[Deploy to Staging]
        H --> K{Smoke Tests Pass?}
        K -->|Yes| L[Manual Approval]
        K -->|No| M[Alert + Rollback]
        L --> N[Deploy to Production]
        N --> O[Health Check]
        O --> P[Done]
    </pre>
    <figcaption style="margin-top:10px;font-family:var(--font-mono);font-size:11px;color:var(--ve-text-dim);">
      End-to-end CI/CD flow with gated production deployment and rollback path.
    </figcaption>
  </figure>

  <div class="legend animate" style="--i:4">
    <div class="legend-item"><div class="legend-swatch" style="background:var(--ve-primary)"></div> Automated step</div>
    <div class="legend-item"><div class="legend-swatch" style="background:var(--ve-tertiary)"></div> Decision gate</div>
    <div class="legend-item"><div class="legend-swatch" style="background:var(--ve-danger)"></div> Failure path</div>
    <div class="legend-item"><div class="legend-swatch" style="background:var(--ve-secondary)"></div> Success</div>
  </div>

  <div class="callout animate" style="--i:5">
    <strong>Hand-drawn mode.</strong> This template uses <code>look: 'handDrawn'</code> for a sketchy aesthetic.
    Switch to <code>look: 'classic'</code> in the Mermaid config for clean, precise lines.
    The <code>layout: 'elk'</code> engine provides better node positioning for complex graphs &mdash;
    it requires the separate <code>@mermaid-js/layout-elk</code> package (imported above). Without it,
    Mermaid silently falls back to dagre.
  </div>

</main>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.12.3/dist/mermaid.esm.min.mjs';
  import elkLayouts from 'https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.2.0/dist/mermaid-layout-elk.esm.min.mjs';

  const styles = getComputedStyle(document.documentElement);
  const cssVar = (name, fallback) => styles.getPropertyValue(name).trim() || fallback;

  mermaid.registerLayoutLoaders(elkLayouts);
  mermaid.initialize({
    startOnLoad: true,
    theme: 'base',
    look: 'handDrawn',
    layout: 'elk',
    securityLevel: 'strict',
    deterministicIds: true,
    maxTextSize: 50000,
    maxEdges: 200,
    themeVariables: {
      primaryColor: cssVar('--ve-surface2', '#eef3f8'),
      primaryBorderColor: cssVar('--ve-accent', '#0f766e'),
      primaryTextColor: cssVar('--ve-text', '#0f172a'),
      secondaryColor: cssVar('--ve-success-dim', 'rgba(21, 128, 61, 0.1)'),
      secondaryBorderColor: cssVar('--ve-success', '#15803d'),
      secondaryTextColor: cssVar('--ve-text', '#0f172a'),
      tertiaryColor: cssVar('--ve-warning-dim', 'rgba(180, 83, 9, 0.1)'),
      tertiaryBorderColor: cssVar('--ve-warning', '#b45309'),
      tertiaryTextColor: cssVar('--ve-text', '#0f172a'),
      lineColor: cssVar('--ve-accent', '#0f766e'),
      fontSize: '16px',
      fontFamily: "'Bricolage Grotesque', system-ui, sans-serif",
      noteBkgColor: cssVar('--ve-surface-elevated', '#fcfdff'),
      noteTextColor: cssVar('--ve-text', '#0f172a'),
      noteBorderColor: cssVar('--ve-warning', '#b45309'),
    }
  });
</script>
<script>
  function updateZoomState(wrap) {
    var target = wrap.querySelector('.mermaid');
    var zoom = parseFloat(target.dataset.zoom || '1');
    wrap.classList.toggle('is-zoomed', zoom > 1);
  }

  function zoomDiagram(btn, factor) {
    var wrap = btn.closest('.mermaid-wrap');
    var target = wrap.querySelector('.mermaid');
    var current = parseFloat(target.dataset.zoom || '1');
    var next = Math.min(Math.max(current * factor, 0.3), 5);
    target.dataset.zoom = next;
    target.style.transform = 'scale(' + next + ')';
    updateZoomState(wrap);
  }

  function resetZoom(btn) {
    var wrap = btn.closest('.mermaid-wrap');
    var target = wrap.querySelector('.mermaid');
    target.dataset.zoom = '1';
    target.style.transform = 'scale(1)';
    updateZoomState(wrap);
  }

  document.querySelectorAll('.mermaid-wrap').forEach(function(wrap) {
    // Scroll-to-zoom (Ctrl/Cmd + wheel)
    wrap.addEventListener('wheel', function(e) {
      if (!e.ctrlKey && !e.metaKey) return;
      e.preventDefault();
      var target = wrap.querySelector('.mermaid');
      var current = parseFloat(target.dataset.zoom || '1');
      var factor = e.deltaY < 0 ? 1.1 : 0.9;
      var next = Math.min(Math.max(current * factor, 0.3), 5);
      target.dataset.zoom = next;
      target.style.transform = 'scale(' + next + ')';
      updateZoomState(wrap);
    }, { passive: false });

    // Drag-to-pan
    var startX, startY, scrollL, scrollT;
    wrap.addEventListener('mousedown', function(e) {
      if (e.target.closest('.zoom-controls')) return;
      var target = wrap.querySelector('.mermaid');
      if (parseFloat(target.dataset.zoom || '1') <= 1) return;
      wrap.classList.add('is-panning');
      startX = e.clientX;
      startY = e.clientY;
      scrollL = wrap.scrollLeft;
      scrollT = wrap.scrollTop;
    });
    window.addEventListener('mousemove', function(e) {
      if (!wrap.classList.contains('is-panning')) return;
      wrap.scrollLeft = scrollL - (e.clientX - startX);
      wrap.scrollTop = scrollT - (e.clientY - startY);
    });
    window.addEventListener('mouseup', function() {
      wrap.classList.remove('is-panning');
    });
  });
</script>

</body>
</html>
