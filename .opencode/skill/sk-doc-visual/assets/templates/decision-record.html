<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <meta name="ve-artifact-type" content="decision-record">
    <meta name="ve-source-doc" content="">
    <meta name="ve-speckit-level" content="3">
    <meta name="ve-view-mode" content="artifact-dashboard">
    <title>Decision Record | SpecKit</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'dark' });</script>
    <style>
        :root {
            --bg: #09090b;
            --surface: rgba(24, 24, 27, 0.65);
            --text: #fafafa;
            --accent: #3b82f6;
            --muted: #a1a1aa;
            --border: rgba(255, 255, 255, 0.1);

            --font-from-0: 13; --font-to-0: 17;
            --vw-from-0: calc(1 / 100); --vw-to-0: calc(991 / 100);
            --coefficient-0: calc((var(--font-to-0) - var(--font-from-0)) / (var(--vw-to-0) - var(--vw-from-0)));
            --base-0: calc((var(--font-from-0) - var(--vw-from-0) * var(--coefficient-0)) / 16);

            --font-from-1: 13; --font-to-1: 17;
            --vw-from-1: calc(991 / 100); --vw-to-1: calc(1440 / 100);
            --coefficient-1: calc((var(--font-to-1) - var(--font-from-1)) / (var(--vw-to-1) - var(--vw-from-1)));
            --base-1: calc((var(--font-from-1) - var(--vw-from-1) * var(--coefficient-1)) / 16);

            --font-from-2: 13; --font-to-2: 15;
            --vw-from-2: calc(1440 / 100); --vw-to-2: calc(1920 / 100);
            --coefficient-2: calc((var(--font-to-2) - var(--font-from-2)) / (var(--vw-to-2) - var(--vw-from-2)));
            --base-2: calc((var(--font-from-2) - var(--vw-from-2) * var(--coefficient-2)) / 16);

            --font-from-3: 16; --font-to-3: 21;
            --vw-from-3: calc(1920 / 100); --vw-to-3: calc(5120 / 100);
            --coefficient-3: calc((var(--font-to-3) - var(--font-from-3)) / (var(--vw-to-3) - var(--vw-from-3)));
            --base-3: calc((var(--font-from-3) - var(--vw-from-3) * var(--coefficient-3)) / 16);

            --font-size-4: 1.3125;
        }

        html {
            font-size: calc(var(--font-size-4) * 1rem);
            scroll-behavior: smooth;
            background-color: var(--bg);
            color: var(--text);
        }

        @media screen and (max-width: 5120px) { html { font-size: calc(var(--base-3) * 1rem + var(--coefficient-3) * 1vw); } }
        @media screen and (max-width: 1920px) { html { font-size: calc(var(--base-2) * 1rem + var(--coefficient-2) * 1vw); } }
        @media screen and (max-width: 1440px) { html { font-size: calc(var(--base-1) * 1rem + var(--coefficient-1) * 1vw); } }
        @media screen and (max-width: 991px)  { html { font-size: calc(var(--base-0) * 1rem + var(--coefficient-0) * 1vw); } }

        body {
            font-family: 'Helvetica', sans-serif;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            background-color: var(--bg);
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 32px 32px;
            background-attachment: fixed;
            position: relative;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

        .page-container { width: 100%; max-width: 90rem; margin: 0 auto; position: relative; z-index: 10; }
        .main-grid { display: grid; grid-template-columns: 260px 1fr; gap: 4rem; }

        .toc-link {
            display: flex; align-items: center; gap: 0.75rem;
            font-size: 0.7rem; font-weight: 600; color: var(--muted);
            padding: 0.5rem 0; transition: all 0.3s ease; letter-spacing: 0.05em;
        }
        .toc-link:hover { color: var(--text); transform: translateX(4px); }
        .toc-link.active { color: var(--accent); text-shadow: 0 0 12px rgba(59, 130, 246, 0.4); }
        .toc-link.active::before {
            content: ''; width: 6px; height: 6px;
            background: var(--accent); border-radius: 50%;
            box-shadow: 0 0 8px var(--accent);
        }

        .terminal-header {
            border-bottom: 1px solid rgba(255,255,255,0.05);
            background: rgba(9, 9, 11, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            z-index: 100;
        }

        .ledger-line { 
            height: 1px; 
            background: linear-gradient(90deg, var(--accent) 0%, rgba(59, 130, 246, 0.1) 50%, transparent 100%); 
            margin: 2rem 0; 
            opacity: 0.5;
        }

        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
        .reveal.active { opacity: 1; transform: translateY(0); }

        .glass-card {
            background: var(--surface); 
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 12px; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .glass-card:hover { 
            border-color: rgba(59, 130, 246, 0.4); 
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.12), 0 0 0 1px rgba(59, 130, 246, 0.1) inset;
            transform: translateY(-4px);
        }

        .adr-card { border-top: 3px solid var(--accent); }

        .scanline {
            position: fixed; top: 0; left: 0; width: 100%; height: 6px;
            background: linear-gradient(to bottom, transparent, rgba(59, 130, 246, 0.3), transparent);
            opacity: 0.7;
            z-index: 200; pointer-events: none;
            animation: scan 8s ease-in-out infinite;
        }
        @keyframes scan { 
            0% { transform: translateY(-100vh); } 
            100% { transform: translateY(100vh); } 
        }

        .glow-bg {
            position: absolute;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.08) 0%, transparent 70%);
            top: -200px;
            left: -200px;
            z-index: 0;
            pointer-events: none;
            border-radius: 50%;
        }

        .text-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #a1a1aa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .text-gradient-accent {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .inline-code {
            font-family: 'JetBrains Mono', monospace; color: #93c5fd; font-size: 0.9em;
            background: rgba(59, 130, 246, 0.1); padding: 0.15rem 0.4rem;
            border-radius: 6px; border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .callout {
            border-left: 3px solid var(--accent); 
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.08) 0%, rgba(59, 130, 246, 0.01) 100%);
            padding: 1.5rem; border-radius: 0 12px 12px 0;
            backdrop-filter: blur(10px);
        }

        .data-table { width: 100%; text-align: left; font-size: 12px; border-collapse: separate; border-spacing: 0; }
        .data-table thead tr { background: rgba(255,255,255,0.03); }
        .data-table th { padding: 1rem; color: var(--muted); font-weight: 600; letter-spacing: 0.1em; border-bottom: 1px solid var(--border); }
        .data-table td { padding: 1rem; color: var(--text); border-bottom: 1px solid rgba(255,255,255,0.04); }
        .data-table tbody tr { transition: all 0.2s ease; }
        .data-table tbody tr:hover { background: rgba(255,255,255,0.04); transform: scale(1.002); }
        .data-table tbody tr:last-child td { border-bottom: none; }

        .viz-bar {
            height: 8px; background: rgba(255,255,255,0.08); border-radius: 8px;
            overflow: hidden; min-width: 100px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }
        .viz-fill {
            height: 100%; border-radius: 8px; width: 0;
            transition: width 1.2s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
        }
        .viz-fill::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: translateX(-100%);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer { 100% { transform: translateX(100%); } }

        .status--match {
            display: inline-flex; align-items: center; gap: 6px;
            font-size: 11px; font-weight: 700; letter-spacing: 0.12em;
            padding: 4px 12px; border-radius: 6px;
            background: rgba(34, 197, 94, 0.15); color: #4ade80; 
            border: 1px solid rgba(34, 197, 94, 0.3);
            box-shadow: 0 0 12px rgba(34, 197, 94, 0.2);
        }
        .status--gap {
            display: inline-flex; align-items: center; gap: 6px;
            font-size: 11px; font-weight: 700; letter-spacing: 0.12em;
            padding: 4px 12px; border-radius: 6px;
            background: rgba(239, 68, 68, 0.15); color: #f87171; 
            border: 1px solid rgba(239, 68, 68, 0.3);
            box-shadow: 0 0 12px rgba(239, 68, 68, 0.2);
        }

        .compare-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }

        @media (max-width: 1024px) {
            .main-grid { grid-template-columns: 1fr; }
            .sidebar { display: none; }
            .compare-grid { grid-template-columns: 1fr; }
        }

        details summary { cursor: pointer; list-style: none; transition: color 0.2s; }
        details summary:hover { color: #60a5fa; }
        details summary::-webkit-details-marker { display: none; }
        details summary::before {
            content: '\25B6'; display: inline-block; margin-right: 0.75rem;
            font-size: 0.7em; transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        details[open] summary::before { transform: rotate(90deg); }
        
        .badge-proposed {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 4px 12px; border-radius: 6px;
            font-size: 10px; font-weight: 700; letter-spacing: 0.15em;
            text-transform: uppercase;
            background: rgba(245, 158, 11, 0.15); color: #fbbf24; 
            border: 1px solid rgba(245, 158, 11, 0.3);
            box-shadow: 0 0 12px rgba(245, 158, 11, 0.2);
        }
    </style>
</head>
<body>
    <div class="selection:bg-blue-500/30 min-h-screen relative w-full">
        <div class="glow-bg"></div>
        <div class="scanline"></div>

        <!-- Status Bar -->
        <div class="terminal-header sticky top-0 px-6 py-3 flex items-center justify-between text-[10px] font-semibold tracking-widest mono text-muted">
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-blue-500 animate-pulse" style="box-shadow: 0 0 8px #3b82f6;"></span>
                    <span class="text-text">Decision Ledger</span>
                </div>
                <div class="hidden md:block">Registry: ADR-Central</div>
                <div class="hidden md:block">Records: 2 Active</div>
            </div>
            <div class="flex items-center gap-6">
                <div id="clock">00:00:00 UTC</div>
                <div class="text-accent">Auth: Verified // Architecture Board</div>
            </div>
        </div>

        <div class="page-container px-6 lg:px-12 py-12">

            <!-- Hero Header -->
            <header class="mb-32 reveal" id="top">
                <div class="flex flex-col lg:flex-row lg:items-end justify-between gap-12">
                    <div class="space-y-6">
                        <div class="inline-flex items-center gap-2 px-3 py-1 border border-blue-500/20 bg-blue-500/10 text-blue-400 text-[10px] font-semibold tracking-widest rounded" style="box-shadow: 0 0 15px rgba(59, 130, 246, 0.15);">
                            Architecture Decision Records // Governance
                        </div>
                        <h1 class="text-7xl md:text-9xl font-semibold tracking-tighter leading-none text-gradient">
                            Decision<br><span class="text-gradient-accent">Record.</span>
                        </h1>
                    </div>
                    <div class="lg:text-right space-y-6">
                        <div class="space-y-1">
                            <p class="text-[10px] font-semibold tracking-widest text-muted">Board Review / Q1 2026</p>
                            <p class="text-3xl font-semibold mono text-gradient">2 ADRs</p>
                        </div>
                        <div class="flex lg:justify-end gap-3">
                            <div class="px-4 py-2 border text-[10px] font-semibold tracking-widest rounded border-[rgba(255,255,255,0.1)] glass-card" style="box-shadow: none;">
                                1 Accepted
                            </div>
                            <div class="px-4 py-2 text-[10px] font-semibold tracking-widest rounded text-bg bg-text">
                                1 Proposed
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ledger-line"></div>
            </header>

            <div class="main-grid">

                <!-- Sidebar TOC -->
                <aside class="sidebar">
                    <nav class="sticky top-24 space-y-12">
                        <div class="space-y-4">
                            <p class="text-[10px] font-semibold tracking-[0.2em] text-muted">Decision Ledger</p>
                            <div id="sidebar-nav" class="flex flex-col gap-1">
                                <a href="#adr-001" class="toc-link active">ADR-001 Overview</a>
                                <a href="#adr-001-context" class="toc-link">Context</a>
                                <a href="#adr-001-decision" class="toc-link">Decision</a>
                                <a href="#adr-001-alternatives" class="toc-link">Alternatives</a>
                                <a href="#adr-001-consequences" class="toc-link">Consequences</a>
                                <a href="#adr-001-five-checks" class="toc-link">Five Checks</a>
                                <a href="#adr-001-implementation" class="toc-link">Implementation</a>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <p class="text-[10px] font-semibold tracking-[0.2em] text-muted">Proposed</p>
                            <div class="flex flex-col gap-1">
                                <a href="#adr-002" class="toc-link">ADR-002 Overview</a>
                            </div>
                        </div>
                    </nav>
                </aside>

                <!-- Content Area -->
                <main class="space-y-[clamp(4rem,10vh,8rem)]">

                    <!-- ============================================================ -->
                    <!-- ADR-001: Full Detail                                         -->
                    <!-- ============================================================ -->

                    <!-- ADR-001 Header -->
                    <section id="adr-001" class="space-y-8 reveal">
                        <h2 class="text-[10px] tracking-[0.3em] font-semibold opacity-80 pb-4 text-text border-b border-[rgba(255,255,255,0.08)]">ADR-001</h2>
                        <div class="glass-card adr-card p-8 space-y-6">
                            <div class="flex flex-wrap items-start justify-between gap-4">
                                <div class="space-y-3">
                                    <h3 class="text-2xl md:text-3xl font-semibold tracking-tight text-gradient">Adopt SQLite with libSQL for Embedded Vector Storage</h3>
                                    <div class="flex flex-wrap items-center gap-3 text-[10px] mono font-semibold tracking-widest text-muted">
                                        <span>2026-01-15</span>
                                        <span class="text-[rgba(255,255,255,0.08)]">|</span>
                                        <span>Deciders: M. Kerkmeester, Architecture Board</span>
                                    </div>
                                </div>
                                <div class="status--match">
                                    <iconify-icon icon="lucide:check-circle" width="14"></iconify-icon>
                                    ACCEPTED
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- ADR-001 Context -->
                    <section id="adr-001-context" class="space-y-8 reveal">
                        <h2 class="text-[10px] tracking-[0.3em] font-semibold pb-4 text-accent border-b border-[rgba(255,255,255,0.08)]">ADR-001 // Context</h2>
                        <div class="callout space-y-4">
                            <div class="flex items-center gap-2 text-[10px] font-semibold tracking-widest text-accent">
                                <iconify-icon icon="lucide:info" width="16"></iconify-icon>
                                PROBLEM BACKGROUND
                            </div>
                            <p class="text-sm leading-relaxed text-muted">
                                The SpecKit Memory MCP server requires a persistent vector storage layer for semantic search across memory files. The current prototype stores embeddings in flat JSON files, leading to O(n) search times, no transactional guarantees, and corruption risk during concurrent writes. As the memory corpus grows beyond 500 entries, search latency exceeds acceptable thresholds (target: &lt;50ms p95 for 1000 memories).
                            </p>
                            <p class="text-sm leading-relaxed text-muted">
                                The storage layer must support hybrid retrieval (keyword + vector), run embedded without external services, remain portable across macOS, Linux, and CI environments, and integrate cleanly with the existing TypeScript codebase via a synchronous FFI or native binding.
                            </p>
                        </div>

                        <!-- Constraints -->
                        <div class="glass-card p-6 space-y-4">
                            <h4 class="text-[10px] font-semibold tracking-widest text-muted flex items-center">
                                <iconify-icon icon="lucide:lock" width="14" class="mr-2"></iconify-icon>
                                CONSTRAINTS
                            </h4>
                            <ul class="space-y-3 text-sm text-muted">
                                <li class="flex items-start gap-3"><span class="text-accent opacity-70">--</span> Must run embedded (no external database process)</li>
                                <li class="flex items-start gap-3"><span class="text-accent opacity-70">--</span> Single-file database for easy backup and portability</li>
                                <li class="flex items-start gap-3"><span class="text-accent opacity-70">--</span> Native TypeScript/Node.js binding (better-sqlite3 or equivalent)</li>
                                <li class="flex items-start gap-3"><span class="text-accent opacity-70">--</span> Must support vector similarity search (cosine or L2 distance)</li>
                                <li class="flex items-start gap-3"><span class="text-accent opacity-70">--</span> Licensing must be permissive (MIT/Apache 2.0/public domain)</li>
                                <li class="flex items-start gap-3"><span class="text-accent opacity-70">--</span> macOS ARM64, Linux x86_64, CI runner compatibility</li>
                            </ul>
                        </div>
                    </section>

                    <!-- ADR-001 Decision -->
                    <section id="adr-001-decision" class="space-y-8 reveal">
                        <h2 class="text-[10px] tracking-[0.3em] font-semibold pb-4 text-accent border-b border-[rgba(255,255,255,0.08)]">ADR-001 // Decision</h2>
                        <div class="glass-card p-8 space-y-4 border-l-[4px] border-accent" style="box-shadow: 0 12px 40px rgba(59, 130, 246, 0.08);">
                            <div class="flex items-center gap-2 text-[10px] font-semibold tracking-widest text-accent">
                                <iconify-icon icon="lucide:gavel" width="16"></iconify-icon>
                                RULING
                            </div>
                            <p class="text-xl md:text-2xl font-semibold tracking-tight leading-snug text-gradient">
                                We chose <span class="text-gradient-accent">SQLite via better-sqlite3</span> with <span class="text-gradient-accent">libSQL vector extensions</span> as the embedded storage engine for SpecKit Memory.
                            </p>
                            <p class="text-sm leading-relaxed text-muted mt-4">
                                SQLite provides battle-tested durability, single-file portability, and a mature Node.js binding ecosystem. The libSQL fork adds native vector column support and cosine similarity functions, eliminating the need for external vector databases while keeping the deployment footprint at zero external dependencies.
                            </p>
                        </div>
                    </section>

                    <!-- ADR-001 Alternatives -->
                    <section id="adr-001-alternatives" class="space-y-8 reveal">
                        <h2 class="text-[10px] tracking-[0.3em] font-semibold pb-4 text-accent border-b border-[rgba(255,255,255,0.08)]">ADR-001 // Alternatives Considered</h2>
                        <div class="glass-card overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="data-table mono">
                                    <thead>
                                        <tr>
                                            <th class="text-[10px]">OPTION</th>
                                            <th class="text-[10px]">PROS</th>
                                            <th class="text-[10px]">CONS</th>
                                            <th class="text-[10px] text-right">SCORE</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="background: rgba(59, 130, 246, 0.08);">
                                            <td class="font-semibold whitespace-nowrap text-accent flex items-center gap-2">
                                                <iconify-icon icon="lucide:check-circle" width="14"></iconify-icon>
                                                SQLite + libSQL
                                            </td>
                                            <td class="text-[11px] text-muted">Zero-dep embedded, single-file, mature ecosystem, native vector columns, proven at scale</td>
                                            <td class="text-[11px] text-muted">Write contention on high concurrency, libSQL fork divergence risk</td>
                                            <td class="text-right">
                                                <div class="flex items-center justify-end gap-3">
                                                    <div class="viz-bar w-24">
                                                        <div class="viz-fill bg-blue-500" data-width="92%" style="box-shadow: 0 0 10px rgba(59, 130, 246, 0.8);"></div>
                                                    </div>
                                                    <span class="text-[12px] font-bold text-accent">92</span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="font-semibold whitespace-nowrap">ChromaDB (embedded)</td>
                                            <td class="text-[11px] text-muted">Purpose-built for vectors, Python-native, easy metadata filtering</td>
                                            <td class="text-[11px] text-muted">Python dependency, no native TS binding, separate process model, heavier footprint</td>
                                            <td class="text-right">
                                                <div class="flex items-center justify-end gap-3">
                                                    <div class="viz-bar w-24">
                                                        <div class="viz-fill bg-amber-500" data-width="61%"></div>
                                                    </div>
                                                    <span class="text-[12px] font-bold text-amber-500">61</span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="font-semibold whitespace-nowrap">LanceDB</td>
                                            <td class="text-[11px] text-muted">Columnar vector-native format, good TS bindings, fast ANN search</td>
                                            <td class="text-[11px] text-muted">Young project (pre-1.0), limited query expressiveness, no FTS integration</td>
                                            <td class="text-right">
                                                <div class="flex items-center justify-end gap-3">
                                                    <div class="viz-bar w-24">
                                                        <div class="viz-fill bg-amber-500" data-width="68%"></div>
                                                    </div>
                                                    <span class="text-[12px] font-bold text-amber-500">68</span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="font-semibold whitespace-nowrap">Flat JSON files</td>
                                            <td class="text-[11px] text-muted">Zero dependencies, simple implementation, human-readable</td>
                                            <td class="text-[11px] text-muted">O(n) search, no ACID, corruption on crash, no indexing, no concurrent access</td>
                                            <td class="text-right">
                                                <div class="flex items-center justify-end gap-3">
                                                    <div class="viz-bar w-24">
                                                        <div class="viz-fill bg-red-500" data-width="28%"></div>
                                                    </div>
                                                    <span class="text-[12px] font-bold text-red-500">28</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>

                    <!-- ADR-001 Consequences -->
                    <section id="adr-001-consequences" class="space-y-8 reveal">
                        <h2 class="text-[10px] tracking-[0.3em] font-semibold pb-4 text-accent border-b border-[rgba(255,255,255,0.08)]">ADR-001 // Consequences</h2>

                        <div class="compare-grid">
                            <!-- What Improves -->
                            <div class="glass-card p-6 space-y-4 border-t-[3px] border-[#4ade80]" style="box-shadow: 0 4px 20px rgba(74, 222, 128, 0.05);">
                                <div class="flex items-center gap-2 text-[10px] font-semibold tracking-widest text-[#4ade80]">
                                    <iconify-icon icon="lucide:trending-up" width="16"></iconify-icon>
                                    WHAT IMPROVES
                                </div>
                                <ul class="space-y-4 text-sm text-muted">
                                    <li class="flex items-start gap-3">
                                        <iconify-icon icon="lucide:check" width="16" class="text-[#4ade80]" style="margin-top: 3px"></iconify-icon>
                                        Search latency drops from 200ms to &lt;15ms p95 via indexed vector lookups
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <iconify-icon icon="lucide:check" width="16" class="text-[#4ade80]" style="margin-top: 3px"></iconify-icon>
                                        ACID transactions eliminate data corruption during concurrent MCP tool calls
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <iconify-icon icon="lucide:check" width="16" class="text-[#4ade80]" style="margin-top: 3px"></iconify-icon>
                                        Single-file backup: copy one <span class="inline-code">.db</span> file to preserve entire memory state
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <iconify-icon icon="lucide:check" width="16" class="text-[#4ade80]" style="margin-top: 3px"></iconify-icon>
                                        Hybrid retrieval (FTS5 + vector cosine) in a single query without external orchestration
                                    </li>
                                </ul>
                            </div>

                            <!-- What It Costs -->
                            <div class="glass-card p-6 space-y-4 border-t-[3px] border-[#fbbf24]" style="box-shadow: 0 4px 20px rgba(251, 191, 36, 0.05);">
                                <div class="flex items-center gap-2 text-[10px] font-semibold tracking-widest text-[#fbbf24]">
                                    <iconify-icon icon="lucide:alert-triangle" width="16"></iconify-icon>
                                    WHAT IT COSTS
                                </div>
                                <ul class="space-y-4 text-sm text-muted">
                                    <li class="flex items-start gap-3">
                                        <iconify-icon icon="lucide:minus" width="16" class="text-[#fbbf24]" style="margin-top: 3px"></iconify-icon>
                                        Native binary dependency (<span class="inline-code">better-sqlite3</span>) requires rebuild per platform/Node version
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <iconify-icon icon="lucide:minus" width="16" class="text-[#fbbf24]" style="margin-top: 3px"></iconify-icon>
                                        libSQL fork introduces tracking overhead to stay aligned with upstream SQLite releases
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <iconify-icon icon="lucide:minus" width="16" class="text-[#fbbf24]" style="margin-top: 3px"></iconify-icon>
                                        Schema migration tooling must be built (no ORM, raw SQL migrations)
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <iconify-icon icon="lucide:minus" width="16" class="text-[#fbbf24]" style="margin-top: 3px"></iconify-icon>
                                        Write-ahead log (WAL) mode complexity for backup tooling
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Risk Table -->
                        <div class="glass-card overflow-hidden mt-8">
                            <div class="p-5 text-[10px] font-semibold tracking-widest text-muted border-b border-[rgba(255,255,255,0.05)] bg-[rgba(255,255,255,0.01)] flex items-center gap-2">
                                <iconify-icon icon="lucide:shield-alert" width="14"></iconify-icon>
                                RISK ASSESSMENT
                            </div>
                            <div class="overflow-x-auto">
                                <table class="data-table mono">
                                    <thead>
                                        <tr>
                                            <th class="text-[10px]">RISK</th>
                                            <th class="text-[10px]">LIKELIHOOD</th>
                                            <th class="text-[10px]">IMPACT</th>
                                            <th class="text-[10px]">MITIGATION</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="font-semibold">libSQL fork abandonment</td>
                                            <td><span class="text-amber-500 font-bold">Medium</span></td>
                                            <td><span class="text-red-500 font-bold">High</span></td>
                                            <td class="text-[11px] text-muted">Vector ops abstracted behind interface; fallback to sqlite-vss or manual brute-force</td>
                                        </tr>
                                        <tr>
                                            <td class="font-semibold">better-sqlite3 Node.js breakage</td>
                                            <td><span class="text-amber-500 font-bold">Medium</span></td>
                                            <td><span class="text-amber-500 font-bold">Medium</span></td>
                                            <td class="text-[11px] text-muted">Pin Node.js version in CI; prebuilt binaries via prebuild-install</td>
                                        </tr>
                                        <tr>
                                            <td class="font-semibold">Database file corruption</td>
                                            <td><span class="text-green-500 font-bold">Low</span></td>
                                            <td><span class="text-red-500 font-bold">High</span></td>
                                            <td class="text-[11px] text-muted">WAL mode + integrity_check pragma on startup; automated checkpoint backups</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>

                    <!-- ADR-001 Five Checks -->
                    <section id="adr-001-five-checks" class="space-y-8 reveal">
                        <h2 class="text-[10px] tracking-[0.3em] font-semibold pb-4 text-accent border-b border-[rgba(255,255,255,0.08)]">ADR-001 // Five Checks Evaluation</h2>

                        <div class="glass-card overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="data-table mono">
                                    <thead>
                                        <tr>
                                            <th class="text-[10px]">CHECK</th>
                                            <th class="text-[10px]">RESULT</th>
                                            <th class="text-[10px]">EVIDENCE</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="font-semibold">Necessary now?</td>
                                            <td><span class="status--match">PASS</span></td>
                                            <td class="text-[11px] text-muted">JSON search exceeds 200ms at 500 memories; production corpus already at 420 entries and growing</td>
                                        </tr>
                                        <tr>
                                            <td class="font-semibold">Alternatives explored?</td>
                                            <td><span class="status--match">PASS</span></td>
                                            <td class="text-[11px] text-muted">4 options evaluated: SQLite+libSQL, ChromaDB, LanceDB, flat JSON. Benchmarked on latency, portability, and ecosystem maturity</td>
                                        </tr>
                                        <tr>
                                            <td class="font-semibold">Simplest sufficient?</td>
                                            <td><span class="status--match">PASS</span></td>
                                            <td class="text-[11px] text-muted">SQLite is the simplest option that satisfies all constraints. No external process, no network dependency, proven single-file model</td>
                                        </tr>
                                        <tr>
                                            <td class="font-semibold">On critical path?</td>
                                            <td><span class="status--match">PASS</span></td>
                                            <td class="text-[11px] text-muted">Blocks hybrid search (spec-136), causal graph (spec-137), and session dedup (spec-138). Three downstream specs depend on this foundation</td>
                                        </tr>
                                        <tr>
                                            <td class="font-semibold">No unplanned tech debt?</td>
                                            <td><span class="status--match">PASS</span></td>
                                            <td class="text-[11px] text-muted">Migration tooling scoped in plan.md. WAL complexity documented. libSQL tracking cadence defined (quarterly review)</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="p-5 flex items-center justify-between border-t border-[rgba(255,255,255,0.05)] bg-[rgba(34,197,94,0.05)]">
                                <span class="text-[10px] font-semibold tracking-widest text-muted">SUMMARY SCORE</span>
                                <div class="flex items-center gap-4">
                                    <div class="viz-bar w-40">
                                        <div class="viz-fill bg-green-500" data-width="100%" style="box-shadow: 0 0 10px rgba(34, 197, 94, 0.8);"></div>
                                    </div>
                                    <span class="text-sm font-bold mono text-green-500">5 / 5 PASS</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- ADR-001 Implementation -->
                    <section id="adr-001-implementation" class="space-y-8 reveal">
                        <h2 class="text-[10px] tracking-[0.3em] font-semibold pb-4 text-accent border-b border-[rgba(255,255,255,0.08)]">ADR-001 // Implementation Notes</h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="glass-card p-6 space-y-4">
                                <div class="flex items-center gap-2 text-[10px] font-semibold tracking-widest text-accent">
                                    <iconify-icon icon="lucide:wrench" width="16"></iconify-icon>
                                    WHAT CHANGES
                                </div>
                                <ul class="space-y-3 text-sm text-muted">
                                    <li class="flex items-start gap-3"><span class="text-accent font-bold">01</span> Replace <span class="inline-code">memory-index.json</span> with <span class="inline-code">speckit.db</span></li>
                                    <li class="flex items-start gap-3"><span class="text-accent font-bold">02</span> Add <span class="inline-code">better-sqlite3</span> + <span class="inline-code">@libsql/client</span> to dependencies</li>
                                    <li class="flex items-start gap-3"><span class="text-accent font-bold">03</span> Create schema migrations under <span class="inline-code">mcp_server/migrations/</span></li>
                                    <li class="flex items-start gap-3"><span class="text-accent font-bold">04</span> Implement <span class="inline-code">DatabaseProvider</span> interface for storage abstraction</li>
                                    <li class="flex items-start gap-3"><span class="text-accent font-bold">05</span> Add <span class="inline-code">PRAGMA integrity_check</span> on server startup</li>
                                </ul>
                            </div>

                            <div class="glass-card p-6 space-y-4">
                                <div class="flex items-center gap-2 text-[10px] font-semibold tracking-widest text-red-500">
                                    <iconify-icon icon="lucide:undo-2" width="16"></iconify-icon>
                                    ROLLBACK PLAN
                                </div>
                                <ul class="space-y-3 text-sm text-muted">
                                    <li class="flex items-start gap-3"><span class="text-red-500 font-bold">01</span> Export all rows to JSON via <span class="inline-code">memory_list --export</span></li>
                                    <li class="flex items-start gap-3"><span class="text-red-500 font-bold">02</span> Revert <span class="inline-code">DatabaseProvider</span> to <span class="inline-code">JsonFileProvider</span></li>
                                    <li class="flex items-start gap-3"><span class="text-red-500 font-bold">03</span> Re-index from exported JSON files</li>
                                    <li class="flex items-start gap-3"><span class="text-red-500 font-bold">04</span> Remove <span class="inline-code">better-sqlite3</span> from dependencies</li>
                                    <li class="flex items-start gap-3"><span class="text-red-500 font-bold">05</span> Estimated rollback time: 30 minutes</li>
                                </ul>
                            </div>
                        </div>
                    </section>

                    <div class="ledger-line"></div>

                    <!-- ============================================================ -->
                    <!-- ADR-002: Condensed with collapsible detail                   -->
                    <!-- ============================================================ -->

                    <section id="adr-002" class="space-y-8 reveal">
                        <h2 class="text-[10px] tracking-[0.3em] font-semibold opacity-80 pb-4 text-text border-b border-[rgba(255,255,255,0.08)]">ADR-002</h2>
                        <div class="glass-card adr-card p-8 space-y-6" style="border-top-color: #fbbf24;">
                            <div class="flex flex-wrap items-start justify-between gap-4">
                                <div class="space-y-3">
                                    <h3 class="text-2xl md:text-3xl font-semibold tracking-tight text-gradient">Replace OpenAI Embeddings with Local Inference via Transformers.js</h3>
                                    <div class="flex flex-wrap items-center gap-3 text-[10px] mono font-semibold tracking-widest text-muted">
                                        <span>2026-02-20</span>
                                        <span class="text-[rgba(255,255,255,0.08)]">|</span>
                                        <span>Deciders: Architecture Board</span>
                                    </div>
                                </div>
                                <div class="badge-proposed">
                                    <iconify-icon icon="lucide:clock" width="14"></iconify-icon>
                                    PROPOSED
                                </div>
                            </div>

                            <!-- Condensed Context -->
                            <div class="callout space-y-3" style="border-left-color: #fbbf24; background: linear-gradient(90deg, rgba(251, 191, 36, 0.08) 0%, rgba(251, 191, 36, 0.01) 100%);">
                                <p class="text-sm leading-relaxed text-muted">
                                    Current embedding generation requires an OpenAI API key and network connectivity, creating a hard external dependency for every <span class="inline-code">memory_save</span> and <span class="inline-code">memory_index_scan</span> operation. This blocks offline development, adds per-call cost (~$0.02/1K tokens), and introduces a latency floor of 200-400ms per embedding call. Transformers.js can run the same <span class="inline-code">all-MiniLM-L6-v2</span> model locally at ~50ms per embedding with zero API cost.
                                </p>
                            </div>
                        </div>

                        <!-- Collapsible Full Detail -->
                        <details class="glass-card overflow-hidden">
                            <summary class="p-6 text-sm font-semibold tracking-wide cursor-pointer text-accent flex items-center bg-[rgba(255,255,255,0.01)] hover:bg-[rgba(255,255,255,0.03)] transition-colors">
                                Expand full decision detail
                            </summary>
                            <div class="p-6 space-y-8 border-t border-[rgba(255,255,255,0.08)]">
                                <!-- Decision -->
                                <div class="space-y-3 border-l-[4px] border-accent" style="padding-left: 1.5rem">
                                    <div class="text-[10px] font-semibold tracking-widest text-accent">RULING</div>
                                    <p class="text-lg font-semibold tracking-tight text-gradient">
                                        We propose adopting <span class="text-gradient-accent">Transformers.js</span> with the <span class="text-gradient-accent">all-MiniLM-L6-v2</span> ONNX model for local embedding generation, removing the OpenAI API dependency entirely.
                                    </p>
                                </div>

                                <!-- Alternatives Table -->
                                <div class="overflow-x-auto">
                                    <table class="data-table mono">
                                        <thead>
                                            <tr>
                                                <th class="text-[10px]">OPTION</th>
                                                <th class="text-[10px]">PROS</th>
                                                <th class="text-[10px]">CONS</th>
                                                <th class="text-[10px] text-right">SCORE</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr style="background: rgba(59, 130, 246, 0.08);">
                                                <td class="font-semibold whitespace-nowrap text-accent flex items-center gap-2">
                                                    <iconify-icon icon="lucide:check-circle" width="14"></iconify-icon>
                                                    Transformers.js
                                                </td>
                                                <td class="text-[11px] text-muted">Zero cost, offline capable, ~50ms latency, same model quality</td>
                                                <td class="text-[11px] text-muted">~80MB model download on first run, ONNX runtime binary</td>
                                                <td class="text-right">
                                                    <div class="flex items-center justify-end gap-3">
                                                        <div class="viz-bar w-24"><div class="viz-fill bg-blue-500" data-width="88%" style="box-shadow: 0 0 10px rgba(59, 130, 246, 0.8);"></div></div>
                                                        <span class="text-[12px] font-bold text-accent">88</span>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="font-semibold whitespace-nowrap">OpenAI API (status quo)</td>
                                                <td class="text-[11px] text-muted">Best quality embeddings, no local compute</td>
                                                <td class="text-[11px] text-muted">Requires API key, network, per-call cost, 200-400ms latency</td>
                                                <td class="text-right">
                                                    <div class="flex items-center justify-end gap-3">
                                                        <div class="viz-bar w-24"><div class="viz-fill bg-amber-500" data-width="55%"></div></div>
                                                        <span class="text-[12px] font-bold text-amber-500">55</span>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="font-semibold whitespace-nowrap">Ollama local server</td>
                                                <td class="text-[11px] text-muted">Broad model selection, GPU acceleration, local</td>
                                                <td class="text-[11px] text-muted">Requires separate process, heavyweight install, not embeddable</td>
                                                <td class="text-right">
                                                    <div class="flex items-center justify-end gap-3">
                                                        <div class="viz-bar w-24"><div class="viz-fill bg-amber-500" data-width="62%"></div></div>
                                                        <span class="text-[12px] font-bold text-amber-500">62</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Five Checks Condensed -->
                                <div class="overflow-x-auto">
                                    <table class="data-table mono">
                                        <thead>
                                            <tr>
                                                <th class="text-[10px]">CHECK</th>
                                                <th class="text-[10px]">RESULT</th>
                                                <th class="text-[10px]">EVIDENCE</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="font-semibold">Necessary now?</td>
                                                <td><span class="status--match">PASS</span></td>
                                                <td class="text-[11px] text-muted">API key requirement is #1 onboarding friction point</td>
                                            </tr>
                                            <tr>
                                                <td class="font-semibold">Alternatives explored?</td>
                                                <td><span class="status--match">PASS</span></td>
                                                <td class="text-[11px] text-muted">3 options benchmarked across latency, cost, and offline capability</td>
                                            </tr>
                                            <tr>
                                                <td class="font-semibold">Simplest sufficient?</td>
                                                <td><span class="status--match">PASS</span></td>
                                                <td class="text-[11px] text-muted">Single npm dependency, no server process, lazy model loading</td>
                                            </tr>
                                            <tr>
                                                <td class="font-semibold">On critical path?</td>
                                                <td><span class="status--gap">FAIL</span></td>
                                                <td class="text-[11px] text-muted">Current API approach works; this is an improvement, not a blocker</td>
                                            </tr>
                                            <tr>
                                                <td class="font-semibold">No unplanned tech debt?</td>
                                                <td><span class="status--match">PASS</span></td>
                                                <td class="text-[11px] text-muted">Embedding interface already abstracted; swap is behind existing contract</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div class="p-5 flex items-center justify-between border-t border-[rgba(255,255,255,0.05)] bg-[rgba(245,158,11,0.05)]">
                                    <span class="text-[10px] font-semibold tracking-widest text-muted">SUMMARY SCORE</span>
                                    <div class="flex items-center gap-4">
                                        <div class="viz-bar w-40"><div class="viz-fill bg-amber-500" data-width="80%" style="box-shadow: 0 0 10px rgba(245, 158, 11, 0.8);"></div></div>
                                        <span class="text-sm font-bold mono text-amber-500">4 / 5 PASS</span>
                                    </div>
                                </div>
                            </div>
                        </details>
                    </section>

                    <!-- Footer -->
                    <footer class="pt-24 flex flex-col md:flex-row justify-between items-start md:items-center gap-8 opacity-60 mb-12 border-t border-[rgba(255,255,255,0.08)]">
                        <div class="space-y-1">
                            <p class="text-[10px] font-semibold tracking-widest">SpecKit Architecture Board</p>
                            <p class="text-[9px] mono">Decision_Hash: 0xa4d72c_ADR_Registry_v1.0</p>
                        </div>
                        <div class="text-right space-y-1">
                            <p class="text-[10px] font-semibold tracking-widest">2026 OpenCode Governance</p>
                            <p class="text-[9px] mono">End of Decision Ledger</p>
                        </div>
                    </footer>

                </main>
            </div>
        </div>
    </div>

    <script>
        function updateClock() {
            const now = new Date();
            const timeStr = now.toISOString().split('T')[1].split('.')[0] + ' UTC';
            const el = document.getElementById('clock');
            if (el) el.textContent = timeStr;
        }
        setInterval(updateClock, 1000);
        updateClock();

        const initObservers = () => {
            const revealObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                        entry.target.querySelectorAll('.viz-fill').forEach(bar => {
                            bar.style.width = bar.getAttribute('data-width');
                        });
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));

            const navLinks = document.querySelectorAll('.toc-link');
            const sections = document.querySelectorAll('section[id]');

            const navObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        navLinks.forEach(link => {
                            link.classList.toggle('active', link.getAttribute('href') === `#${id}`);
                        });
                    }
                });
            }, { rootMargin: '-20% 0px -70% 0px' });

            sections.forEach(section => navObserver.observe(section));
        };

        window.addEventListener('DOMContentLoaded', initObservers);
    </script>
</body>
</html>