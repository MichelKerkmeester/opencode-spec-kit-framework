# ─────────────────────────────────────────────────────────────────
# SCRIPTED RESPONSES FOR SPEC KIT COMMAND TEST SUITE
# ─────────────────────────────────────────────────────────────────
# Each test case defines the scripted user inputs that would be
# provided at each interaction point in the YAML workflow.

# ─────────────────────────────────────────────────────────────────
# PLAN COMMAND TESTS
# ─────────────────────────────────────────────────────────────────
plan:
  T-PLAN-01:
    name: "Happy path :auto"
    mode: auto
    user_inputs:
      request: "Implement JWT authentication with RS256 signing, token refresh, and protected routes"
      spec_folder: ""  # auto-create
      context: ""
      issues: ""
      environment: ""
      scope: ""
    setup_responses:
      Q1: "B"  # New folder
      Q3: "A"  # Single agent
    step_responses:
      step_1_confidence: 85
      step_3_confidence: 90
      step_5_confidence: 88
      step_7_handover: "decline"
    expected_artifacts: [spec.md, plan.md, tasks.md, checklist.md]
    expected_quality_gates:
      pre: { score: 100, threshold: 70 }
      post: { score: 85, threshold: 70 }

  T-PLAN-02:
    name: "Low confidence"
    mode: auto
    user_inputs:
      request: "Implement something with authentication"
      spec_folder: ""
      context: ""
      issues: ""
      environment: ""
      scope: ""
    setup_responses:
      Q1: "B"
    step_responses:
      step_1_confidence: 30
      clarification_response: "A"  # First interpretation
    expected_behavior: "workflow_pauses_for_clarification"
    expected_artifacts: []

  T-PLAN-03:
    name: "Missing feature description"
    mode: auto
    user_inputs:
      request: ""  # Empty - should trigger Q0
      spec_folder: ""
      context: ""
      issues: ""
      environment: ""
      scope: ""
    expected_behavior: "q0_blocks_until_answered"
    expected_artifacts: []

# ─────────────────────────────────────────────────────────────────
# IMPLEMENT COMMAND TESTS
# ─────────────────────────────────────────────────────────────────
implement:
  T-IMPL-01:
    name: "Happy path :auto"
    mode: auto
    fixture: "base-spec-folder"
    user_inputs:
      spec_folder: "specs/042-jwt-authentication"
      request: ""  # Default: comprehensive review
    step_responses:
      step_6_confidence: 85
      step_9_handover: "decline"
    expected_artifacts: [tasks.md, implementation-summary.md]
    expected_task_completion: "all_marked_x"
    expected_quality_gates:
      pre: { score: 100, threshold: 70 }
      post: { score: 85, threshold: 70 }

  T-IMPL-02:
    name: "Missing plan.md"
    mode: auto
    fixture: "empty-spec-folder"
    user_inputs:
      spec_folder: "specs/042-jwt-authentication"
    expected_behavior: "prerequisite_check_fails"
    expected_redirect: "/spec_kit:plan"
    expected_artifacts: []

  T-IMPL-03:
    name: "Debug threshold"
    mode: auto
    fixture: "base-spec-folder"
    user_inputs:
      spec_folder: "specs/042-jwt-authentication"
    step_responses:
      task_failures: 3
      debug_choice: "A"  # Dispatch debug
    expected_behavior: "debug_dispatch_offered"
    expected_artifacts: [debug-delegation.md]

# ─────────────────────────────────────────────────────────────────
# COMPLETE COMMAND TESTS
# ─────────────────────────────────────────────────────────────────
complete:
  T-COMP-01:
    name: "Happy path :auto"
    mode: auto
    user_inputs:
      request: "Build a notification system with in-app alerts and email delivery"
      spec_folder: ""
      context: ""
      issues: ""
      environment: ""
      scope: ""
    step_responses:
      all_confidence: 85
      step_14_handover: "decline"
    expected_artifacts: [spec.md, plan.md, tasks.md, checklist.md, implementation-summary.md]
    expected_quality_gates:
      pre: { score: 100, threshold: 70 }
      planning_gate: { score: 85, threshold: 70 }
      post: { score: 85, threshold: 70 }

  T-COMP-02:
    name: "Planning gate fail"
    mode: auto
    fixture: "error-spec-folder"
    user_inputs:
      request: "Build notification system"
      spec_folder: "specs/043-notification-system"
    expected_behavior: "planning_gate_below_70"
    expected_artifacts: [spec.md]

# ─────────────────────────────────────────────────────────────────
# RESEARCH COMMAND TESTS
# ─────────────────────────────────────────────────────────────────
research:
  T-RES-01:
    name: "Happy path :auto"
    mode: auto
    user_inputs:
      request: "Research WebSocket-based real-time collaboration patterns for document editing"
      spec_folder: ""
      context: ""
      issues: ""
      environment: ""
      scope: ""
    step_responses:
      all_confidence: 80
    expected_artifacts: [research.md]
    expected_research_sections: 17
    expected_quality_gates:
      pre: { score: 100, threshold: 70 }
      post: { score: 85, threshold: 70 }

  T-RES-02:
    name: "Empty codebase"
    mode: auto
    user_inputs:
      request: "Research GraphQL federation patterns"
      spec_folder: ""
    step_responses:
      step_3_codebase_findings: "none"
      all_confidence: 60
    expected_behavior: "research_complete_with_gaps_documented"
    expected_artifacts: [research.md]

# ─────────────────────────────────────────────────────────────────
# DEBUG COMMAND TESTS
# ─────────────────────────────────────────────────────────────────
debug:
  T-DBG-01:
    name: "Happy path :auto"
    mode: auto
    user_inputs:
      spec_path: "specs/042-jwt-authentication"
      error_message: "TypeError: Cannot read properties of undefined (reading 'verify') at JwtService.validateToken (src/auth/jwt.service.ts:45)"
      affected_files: ["src/auth/jwt.service.ts", "src/auth/auth.middleware.ts"]
      previous_attempts: ["Checked import path", "Verified constructor injection", "Added null check"]
    step_responses:
      step_5_integration: "A"  # Apply fix
    expected_artifacts: [debug-delegation.md]
    expected_status: "RESOLVED"

  T-DBG-02:
    name: "Escalation"
    mode: auto
    user_inputs:
      spec_path: "specs/042-jwt-authentication"
      error_message: "Intermittent ECONNRESET during token refresh under load"
      affected_files: ["src/auth/auth.controller.ts"]
      previous_attempts: ["Increased timeout", "Added retry logic", "Checked connection pool"]
    step_responses:
      subagent_response: "Escalation"
    expected_behavior: "escalation_with_fallback_options"
    expected_status: "ESCALATE"

# ─────────────────────────────────────────────────────────────────
# RESUME COMMAND TESTS
# ─────────────────────────────────────────────────────────────────
resume:
  T-RSM-01:
    name: "Happy path :auto"
    mode: auto
    fixture: "base-spec-folder"  # Has handover.md
    user_inputs:
      spec_folder: "specs/042-jwt-authentication"
    expected_behavior: "session_detected_progress_shown"
    expected_outputs: [resume_summary, progress_percentage, next_action]

  T-RSM-02:
    name: "No active session"
    mode: auto
    fixture: "empty-spec-folder"
    user_inputs:
      spec_folder: ""
    expected_behavior: "no_session_message"
    expected_suggestion: "/spec_kit:complete"

  T-RSM-03:
    name: "Stale session"
    mode: auto
    fixture: "base-spec-folder"
    user_inputs:
      spec_folder: "specs/042-jwt-authentication"
    step_responses:
      handover_age_days: 10
      stale_choice: "A"  # Resume anyway
    expected_behavior: "stale_warning_with_options"

# ─────────────────────────────────────────────────────────────────
# HANDOVER COMMAND TESTS
# ─────────────────────────────────────────────────────────────────
handover:
  T-HND-01:
    name: "Happy path"
    mode: auto
    fixture: "base-spec-folder"
    user_inputs:
      spec_folder: "specs/042-jwt-authentication"
    session_context:
      phase: "IMPLEMENTATION"
      completed_tasks: ["T001", "T002", "T003", "T004"]
      pending_tasks: ["T005", "T006", "T007", "T008", "T009", "T010"]
      last_action: "Implemented JwtService sign/verify methods"
      active_file: "src/auth/auth.controller.ts:1"
    expected_artifacts: [handover.md]
    expected_sections: 7
    expected_attempt: 1

  T-HND-02:
    name: "No spec folder"
    mode: auto
    fixture: "empty-spec-folder"
    user_inputs:
      spec_folder: ""
    expected_behavior: "no_session_message"

  T-HND-03:
    name: "Increment attempt"
    mode: auto
    fixture: "base-spec-folder"  # Has existing handover.md with Attempt 1
    user_inputs:
      spec_folder: "specs/042-jwt-authentication"
    session_context:
      existing_handover_attempt: 1
    expected_artifacts: [handover.md]
    expected_attempt: 2
