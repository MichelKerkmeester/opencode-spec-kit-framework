<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analysis: System Spec Kit MCP SQLite vs libSQL/Turso</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --ve-font-body: 'IBM Plex Sans', system-ui, sans-serif;
    --ve-font-mono: 'IBM Plex Mono', 'SF Mono', Consolas, monospace;
    --ve-bg: #faf7f5;
    --ve-surface: #ffffff;
    --ve-surface-2: #f5f0ec;
    --ve-border: rgba(0, 0, 0, 0.08);
    --ve-border-strong: rgba(0, 0, 0, 0.16);
    --ve-text: #2a1f17;
    --ve-text-dim: #7e7062;
    --ve-accent: #c2410c;
    --ve-accent-dim: rgba(194, 65, 12, 0.09);
    --ve-accent-2: #4d7c0f;
    --ve-shadow: 0 16px 36px rgba(41, 32, 23, 0.08);
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --ve-bg: #191411;
      --ve-surface: #241d19;
      --ve-surface-2: #2f2621;
      --ve-border: rgba(255, 255, 255, 0.08);
      --ve-border-strong: rgba(255, 255, 255, 0.16);
      --ve-text: #f0e8df;
      --ve-text-dim: #b39f8d;
      --ve-accent: #fb923c;
      --ve-accent-dim: rgba(251, 146, 60, 0.15);
      --ve-accent-2: #bef264;
      --ve-shadow: 0 20px 44px rgba(0, 0, 0, 0.35);
    }
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    padding: 34px 20px 72px;
    color: var(--ve-text);
    font-family: var(--ve-font-body);
    background-color: var(--ve-bg);
    background-image: radial-gradient(1100px 560px at 5% 0%, var(--ve-accent-dim), transparent 62%), radial-gradient(900px 460px at 96% 100%, color-mix(in srgb, var(--ve-accent-2) 15%, transparent), transparent 60%);
  }

  .layout {
    width: min(1240px, 100%);
    margin: 0 auto;
    display: grid;
    grid-template-columns: 280px minmax(0, 1fr);
    gap: 22px;
  }

  .panel {
    min-width: 0;
    background: var(--ve-surface);
    border: 1px solid var(--ve-border);
    border-radius: 14px;
    box-shadow: var(--ve-shadow);
  }

  .sidebar {
    position: sticky;
    top: 16px;
    align-self: start;
    padding: 16px;
  }

  .tag {
    font-family: var(--ve-font-mono);
    font-size: 11px;
    letter-spacing: 1.2px;
    text-transform: uppercase;
    color: var(--ve-accent);
    margin: 0 0 8px;
  }

  .sidebar h2 {
    margin: 0 0 8px;
    font-size: 20px;
    line-height: 1.24;
  }

  .meta {
    font-family: var(--ve-font-mono);
    font-size: 11px;
    line-height: 1.45;
    color: var(--ve-text-dim);
    margin: 0 0 16px;
  }

  .toc-title {
    margin: 0 0 8px;
    font-family: var(--ve-font-mono);
    font-size: 11px;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--ve-text-dim);
  }

  .toc {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: 8px;
    min-width: 0;
  }

  .toc a {
    display: block;
    text-decoration: none;
    color: var(--ve-text);
    border: 1px solid var(--ve-border);
    background: var(--ve-surface-2);
    border-radius: 8px;
    padding: 7px 10px;
    font-size: 12px;
    line-height: 1.35;
    min-width: 0;
    overflow-wrap: break-word;
    transition: background-color 0.15s ease, border-color 0.15s ease;
  }

  .toc a:hover {
    background: var(--ve-accent-dim);
    border-color: var(--ve-border-strong);
  }

  .toc a.h3 {
    margin-left: 10px;
    font-size: 11px;
  }

  .content-wrap {
    padding: 26px 30px 32px;
    min-width: 0;
  }

  .hero {
    margin-bottom: 18px;
    padding: 20px 22px;
    border: 1px solid var(--ve-border);
    border-left: 4px solid var(--ve-accent);
    border-radius: 10px;
    background: color-mix(in srgb, var(--ve-surface) 72%, var(--ve-accent-dim));
  }

  .hero h1 {
    margin: 0 0 8px;
    font-size: clamp(31px, 3.2vw, 42px);
    line-height: 1.08;
    letter-spacing: -0.02em;
    text-wrap: balance;
  }

  .hero p {
    margin: 0;
    font-family: var(--ve-font-mono);
    font-size: 12px;
    color: var(--ve-text-dim);
  }

  #content > h1:first-child { display: none; }

  #content h2 {
    margin: 26px 0 10px;
    padding: 8px 12px;
    border: 1px solid var(--ve-border);
    border-left: 4px solid var(--ve-accent);
    border-radius: 8px;
    background: var(--ve-surface-2);
    font-size: 24px;
    line-height: 1.2;
    text-wrap: balance;
  }

  #content h3 {
    margin: 20px 0 8px;
    font-size: 19px;
    line-height: 1.3;
  }

  #content h4 {
    margin: 16px 0 8px;
    font-size: 15px;
    line-height: 1.35;
  }

  #content p,
  #content li {
    font-size: 14px;
    line-height: 1.72;
    overflow-wrap: break-word;
  }

  #content ul,
  #content ol {
    margin: 8px 0 12px 22px;
    padding: 0;
  }

  #content code {
    font-family: var(--ve-font-mono);
    font-size: 0.84em;
    background: var(--ve-accent-dim);
    color: var(--ve-accent);
    padding: 2px 6px;
    border-radius: 5px;
    overflow-wrap: break-word;
  }

  #content pre {
    margin: 12px 0;
    padding: 13px;
    border: 1px solid var(--ve-border);
    border-radius: 10px;
    background: var(--ve-surface-2);
    overflow-x: auto;
  }

  #content pre code {
    background: transparent;
    color: inherit;
    padding: 0;
  }

  .table-scroll {
    margin: 12px 0 16px;
    border: 1px solid var(--ve-border);
    border-radius: 10px;
    overflow-x: auto;
    background: var(--ve-surface);
  }

  #content table {
    width: 100%;
    border-collapse: collapse;
    min-width: 860px;
  }

  #content th,
  #content td {
    border-bottom: 1px solid var(--ve-border);
    text-align: left;
    vertical-align: top;
    padding: 10px 12px;
    font-size: 13px;
    line-height: 1.55;
    overflow-wrap: break-word;
  }

  #content thead th {
    position: sticky;
    top: 0;
    z-index: 1;
    background: var(--ve-surface-2);
    color: var(--ve-text-dim);
    font-family: var(--ve-font-mono);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-size: 10px;
  }

  #content tr:last-child td { border-bottom: 0; }

  #content blockquote {
    margin: 12px 0;
    padding: 10px 12px;
    border-left: 3px solid var(--ve-accent-2);
    border-radius: 0 8px 8px 0;
    background: var(--ve-surface-2);
  }

  #content a {
    color: var(--ve-accent);
    text-underline-offset: 2px;
    text-decoration-thickness: 1px;
    overflow-wrap: break-word;
  }

  .anim {
    opacity: 0;
    transform: translateY(8px);
    animation: fadeUp 0.38s ease forwards;
    animation-delay: calc(var(--i, 0) * 0.04s);
  }

  @keyframes fadeUp {
    to { opacity: 1; transform: translateY(0); }
  }

  @media (max-width: 980px) {
    .layout { grid-template-columns: 1fr; }
    .sidebar { position: static; }
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-delay: 0ms !important;
      transition-duration: 0.01ms !important;
      animation: none !important;
      transition: none !important;
    }
  }
</style>
</head>
<body>
<div class="layout">
  <aside class="sidebar panel">
    <p class="tag">Visual Explainer</p>
    <h2>Analysis: System Spec Kit MCP SQLite vs libSQL/Turso</h2>
    <p class="meta">Architecture-grade research visual<br>Generated: 2026-02-21 19:18:05</p>
    <p class="toc-title">Sections</p>
    <ul id="toc" class="toc"></ul>
  </aside>
  <main class="content-wrap panel">
    <header class="hero">
      <h1>Analysis: System Spec Kit MCP SQLite vs libSQL/Turso</h1>
      <p>Architecture-grade research visual</p>
    </header>
    <article id="content">
<h1>Analysis: System Spec Kit MCP SQLite vs libSQL/Turso</h1>
<p>Index: Companion recommendation document at <a href="specs/003-system-spec-kit/140-sqlite-to-libsql/recommendation-sqlite-vs-libsql-decision.md"><code>specs/003-system-spec-kit/140-sqlite-to-libsql/recommendation-sqlite-vs-libsql-decision.md</code></a>.</p>
<h2>1) Executive Summary (Dated Context)</h2>
<p>Source validation date: <strong>February 21, 2026</strong>.</p>
<p>This analysis concludes that the current System Spec Kit MCP server should <strong>remain on local SQLite now</strong> and should not move directly to Turso/libSQL runtime in a single step.</p>
<p>Why this conclusion is evidence-based:</p>
<ul>
<li>The active runtime is tightly coupled to <code>better-sqlite3</code> process-local DB handles, SQLite PRAGMAs, and filesystem-level assumptions for DB path, permissions, and file-backed content reads. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:15</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:284</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1184</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1197</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:2517</code>)</li>
<li>Search is implemented with SQLite-specific virtual tables and SQL: <code>fts5</code> triggers and <code>sqlite-vec</code> (<code>vec0</code>, <code>vec_distance_cosine</code>). (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1602</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1622</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:2118</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/sqlite-fts.ts:90</code>)</li>
<li>Operational controls (checkpoint/restore, bulk delete, schema downgrade, startup wiring) are designed around in-process direct SQL transactions and local DB reinitialization. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:313</code>, <code>.opencode/skill/system-spec-kit/mcp_server/core/db-state.ts:141</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:82</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:298</code>)</li>
<li>Current package dependencies are SQLite-native (<code>better-sqlite3</code>, <code>sqlite-vec</code>) and do not include a Turso/libSQL client dependency. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/package.json:36</code>, <code>.opencode/skill/system-spec-kit/mcp_server/package.json:37</code>)</li>
</ul>
<p>libSQL/Turso is still strategically relevant because:</p>
<ul>
<li>libSQL preserves SQLite file compatibility and embeddability goals. (Local libSQL clone: <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/README.md:126</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/README.md:128</code>)</li>
<li>Turso/libSQL provides remote protocol options, durability controls, and replica/sync features that can become important at scale.</li>
</ul>
<p>However, protocol and consistency semantics differ materially from the current local runtime:</p>
<ul>
<li>HTTP v2 uses baton-based stream continuity and explicit request serialization.</li>
<li>Replica visibility is not globally ordered across all processes/instances.</li>
</ul>
<p>(Local libSQL clone: <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/HTTP_V2_SPEC.md:14</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/HTTP_V2_SPEC.md:17</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/CONSISTENCY_MODEL.md:13</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/CONSISTENCY_MODEL.md:17</code>)</p>
<p>Bottom line: <strong>schema/data portability is partially favorable; runtime portability is not yet ready without an adapter-first redesign.</strong></p>
<h2>2) Current-State Architecture Map</h2>
<h3>2.1 Runtime topology</h3>
<pre><code class="language-text">MCP Client
  -&gt; context-server (stdio transport)
     -&gt; tool dispatch
        -&gt; vector-index (SQLite + sqlite-vec + FTS5)
        -&gt; checkpoints (gzip snapshot + restore transaction)
        -&gt; hybrid search / BM25 / cognitive modules
        -&gt; db-state reinitialize logic

CLI (spec-kit-cli)
  -&gt; same vector-index/checkpoint/db-state stack
  -&gt; stats, bulk-delete, reindex, schema-downgrade
</code></pre>
<p>Evidence:</p>
<ul>
<li>MCP transport is stdio-based, not remote DB protocol-native. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/context-server.ts:17</code>, <code>.opencode/skill/system-spec-kit/mcp_server/context-server.ts:677</code>, <code>.opencode/skill/system-spec-kit/mcp_server/context-server.ts:679</code>)</li>
<li>Context server startup initializes local DB and module handles directly. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/context-server.ts:450</code>, <code>.opencode/skill/system-spec-kit/mcp_server/context-server.ts:565</code>, <code>.opencode/skill/system-spec-kit/mcp_server/context-server.ts:571</code>)</li>
<li>CLI uses the same local vector index and checkpoint modules. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:17</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:18</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:82</code>)</li>
</ul>
<h3>2.2 Storage and schema mechanics</h3>
<ul>
<li>DB path resolution prioritizes local env vars and local filesystem DB path. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:285</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:289</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:292</code>)</li>
<li>The DB is opened through <code>better-sqlite3</code>, then PRAGMAs are set (<code>journal_mode=WAL</code>, busy timeout, mmap, synchronous, temp store). (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1152</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1184</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1190</code>)</li>
<li>Core schema includes <code>memory_index</code>, <code>memory_fts</code> (fts5), optional <code>vec_memories</code> (<code>vec0</code>) and companion tables (<code>checkpoints</code>, <code>memory_history</code>, <code>memory_conflicts</code>). (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1549</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1602</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1622</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1490</code>)</li>
</ul>
<h3>2.3 Search architecture</h3>
<ul>
<li>Vector search uses <code>vec_distance_cosine</code> and joins <code>memory_index</code> with <code>vec_memories</code>. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:2118</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:2121</code>)</li>
<li>If <code>sqlite-vec</code> fails to load, runtime falls back to keyword-only behavior. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1178</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1180</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:2510</code>)</li>
<li>FTS5 BM25 search is explicitly SQLite FTS5-specific SQL. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/sqlite-fts.ts:51</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/sqlite-fts.ts:90</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/sqlite-fts.ts:126</code>)</li>
</ul>
<h2>3) SQLite Coupling Inventory with Severity</h2>
<h3>3.1 Hard blockers (must redesign before direct Turso/libSQL runtime switch)</h3>
<table>
<thead>
<tr>
<th>Coupling point</th>
<th>Why hard</th>
<th>Evidence</th>
</tr>
</thead>
<tbody><tr>
<td><code>better-sqlite3</code> direct sync handle and statement model</td>
<td>Codebase assumes synchronous in-process API behavior and direct transaction wrappers</td>
<td>Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:15</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1742</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:313</code></td>
</tr>
<tr>
<td>SQLite-vector SQL dialect (<code>vec0</code>, <code>vec_distance_cosine</code>)</td>
<td>Current SQL uses sqlite-vec table/function semantics not guaranteed identical to Turso native vector APIs</td>
<td>Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1602</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:2118</code>; Web: <code>https://docs.turso.tech/features/ai-and-embeddings</code>, <code>https://docs.turso.tech/features/sqlite-extensions</code></td>
</tr>
<tr>
<td>Runtime PRAGMA and file-level assumptions</td>
<td>System configures local SQLite pragmas and chmods DB file permissions</td>
<td>Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1184</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1197</code></td>
</tr>
<tr>
<td>Checkpoint restore transaction semantics tied to direct table writes</td>
<td>Restore path assumes local atomic delete/insert transaction and optional vec table purge</td>
<td>Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:313</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:316</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:317</code></td>
</tr>
<tr>
<td>No runtime backend selector/token/endpoint contract today</td>
<td>Startup and CLI open local DB directly; package does not ship libSQL/Turso client dependency</td>
<td>Local: <code>.opencode/skill/system-spec-kit/mcp_server/context-server.ts:450</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:82</code>, <code>.opencode/skill/system-spec-kit/mcp_server/package.json:33</code>, <code>.opencode/skill/system-spec-kit/mcp_server/package.json:36</code></td>
</tr>
</tbody></table>
<h3>3.2 Medium blockers (adapter + operational changes required)</h3>
<table>
<thead>
<tr>
<th>Coupling point</th>
<th>Why medium</th>
<th>Evidence</th>
</tr>
</thead>
<tbody><tr>
<td>FTS5 trigger and virtual table lifecycle</td>
<td>FTS exists in Turso, but trigger/table bootstrap and migration behavior must be revalidated under remote/replica modes</td>
<td>Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1622</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1630</code>; Web: <code>https://docs.turso.tech/features/sqlite-extensions</code></td>
</tr>
<tr>
<td>DB reinitialization via local updated-file signaling</td>
<td>Current stale-handle refresh relies on local file notification and direct handle reinit</td>
<td>Local: <code>.opencode/skill/system-spec-kit/mcp_server/core/db-state.ts:101</code>, <code>.opencode/skill/system-spec-kit/mcp_server/core/db-state.ts:141</code></td>
</tr>
<tr>
<td>CLI safety workflows tied to local checkpoints</td>
<td>Bulk-delete and restore procedures assume local checkpoint + immediate transaction execution</td>
<td>Local: <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:256</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:298</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:338</code></td>
</tr>
</tbody></table>
<h3>3.3 Soft blockers (mostly configuration and testing effort)</h3>
<table>
<thead>
<tr>
<th>Coupling point</th>
<th>Why soft</th>
<th>Evidence</th>
</tr>
</thead>
<tbody><tr>
<td>Schema version migration framework</td>
<td>Migration framework is robust/transactional and can carry forward with adapter compatibility tests</td>
<td>Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1091</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1123</code></td>
</tr>
<tr>
<td>Fallback keyword path when vectors unavailable</td>
<td>Existing graceful degradation path can help phased rollout testing</td>
<td>Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1178</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:2510</code></td>
</tr>
</tbody></table>
<h2>4) Compatibility Matrix (Current Feature vs Turso/libSQL vs Migration Effort)</h2>
<table>
<thead>
<tr>
<th>Current capability</th>
<th>Current implementation evidence</th>
<th>Turso/libSQL support posture</th>
<th>Migration effort</th>
</tr>
</thead>
<tbody><tr>
<td>SQLite file compatibility</td>
<td>Local DB file model in runtime</td>
<td>libSQL states SQLite file compatibility commitment</td>
<td>Low for raw data file transfer; higher for runtime behavior. (Local libSQL clone: <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/README.md:126</code>)</td>
</tr>
<tr>
<td>Embedded/local operation</td>
<td>In-process local DB</td>
<td>libSQL states embeddable mode remains</td>
<td>Medium (adapter + env contracts). (Local libSQL clone: <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/README.md:128</code>)</td>
</tr>
<tr>
<td>Vector similarity search</td>
<td><code>sqlite-vec</code> (<code>vec0</code>, <code>vec_distance_cosine</code>)</td>
<td>Turso provides native vector support; sqlite-vec availability depends on extension model/plan</td>
<td>High (query/schema adaptation + parity tests). (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1602</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:2118</code>; Web: <code>https://docs.turso.tech/features/ai-and-embeddings</code>, <code>https://docs.turso.tech/features/sqlite-extensions</code>)</td>
</tr>
<tr>
<td>Full-text search</td>
<td>FTS5 virtual table + BM25 SQL</td>
<td>FTS5 is listed as preloaded</td>
<td>Medium (semantic parity and ranking drift validation). (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/sqlite-fts.ts:90</code>; Web: <code>https://docs.turso.tech/features/sqlite-extensions</code>)</td>
</tr>
<tr>
<td>Atomic migrations</td>
<td>Transaction-wrapped migrations</td>
<td>Supported conceptually, but remote stream behavior must be explicitly handled</td>
<td>Medium-High for remote protocol paths. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1093</code>)</td>
</tr>
<tr>
<td>Checkpoint/restore</td>
<td>JSON+gzip snapshot plus restore transaction</td>
<td>Could be retained as app-level feature, but must revalidate with remote consistency/latency</td>
<td>Medium-High. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:177</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:313</code>)</td>
</tr>
<tr>
<td>Operational CLI</td>
<td>Direct local SQL + safety checkpoints</td>
<td>Requires auth/token/network handling in remote modes</td>
<td>High if CLI must manage remote safely. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:82</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:262</code>)</td>
</tr>
<tr>
<td>Consistency assumptions</td>
<td>Local single-process style visibility</td>
<td>Replica model includes process read-your-writes and monotonic reads, but no global ordering guarantee</td>
<td>High for multi-process correctness-sensitive flows. (Local libSQL clone: <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/CONSISTENCY_MODEL.md:13</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/CONSISTENCY_MODEL.md:17</code>)</td>
</tr>
</tbody></table>
<h2>5) Protocol and Consistency Implications</h2>
<h3>5.1 Baton semantics and stream serialization</h3>
<p>If remote HTTP v2 is used, request sequencing rules become explicit:</p>
<ul>
<li>Requests on the same stream are chained by baton.</li>
<li>Client must serialize requests and wait for prior response.</li>
<li>Stream can close after idle; baton may become null; HTTP errors invalidate stream.</li>
</ul>
<p>(Local libSQL clone: <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/HTTP_V2_SPEC.md:14</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/HTTP_V2_SPEC.md:17</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/HTTP_V2_SPEC.md:24</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/HTTP_V2_SPEC.md:73</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/HTTP_V2_SPEC.md:94</code>)</p>
<p>Implication for this codebase:</p>
<ul>
<li>Existing local transaction closures and in-process statements do not model baton lifecycle errors/retries explicitly.</li>
<li>Any remote adapter must track baton, stream invalidation, and idempotent retry behavior.</li>
</ul>
<h3>5.2 Replica visibility model</h3>
<p>libSQL/sqld consistency docs indicate:</p>
<ul>
<li>Primary operations are linearizable.</li>
<li>Process/connection sees its own writes.</li>
<li>Distinct processes on replica can see different points in time.</li>
<li>No global ordering guarantees across instances.</li>
</ul>
<p>(Local libSQL clone: <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/CONSISTENCY_MODEL.md:13</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/CONSISTENCY_MODEL.md:15</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/CONSISTENCY_MODEL.md:17</code>)</p>
<p>Implication for this codebase:</p>
<ul>
<li>Features that currently assume immediate same-process local visibility are safe locally.</li>
<li>Multi-process operations (CLI + server concurrently, or multiple workers) need explicit consistency-mode aware validation before hybrid/remote rollout.</li>
</ul>
<h3>5.3 Stateless HTTP batch caveat</h3>
<p>The older stateless SQL HTTP API notes no interactive transactions and forbids explicit transaction statements in request batches.</p>
<p>(Local libSQL clone: <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/http_api.md:47</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/http_api.md:49</code>)</p>
<p>Implication:</p>
<ul>
<li>If any fallback path uses stateless endpoints, checkpoint/restore semantics must avoid assumptions about long-lived interactive transaction sessions.</li>
</ul>
<h2>6) Operational Impact</h2>
<h3>6.1 Local file assumptions</h3>
<ul>
<li>DB location and directory permissions are process-local and filesystem-managed. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:285</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1146</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1148</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1197</code>)</li>
<li>Search enrichment reads source files directly from local paths. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:2517</code>)</li>
</ul>
<p>Operational effect if migrating:</p>
<ul>
<li>Need explicit strategy for local file content availability and path validity when DB backend is remote/hybrid.</li>
</ul>
<h3>6.2 PRAGMA assumptions</h3>
<p>Current runtime sets:</p>
<ul>
<li><code>journal_mode=WAL</code></li>
<li><code>busy_timeout=10000</code></li>
<li><code>foreign_keys=ON</code></li>
<li>cache/mmap/synchronous/temp_store pragmas</li>
</ul>
<p>(Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1184</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1185</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1186</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1189</code>)</p>
<p>Operational effect if migrating:</p>
<ul>
<li>Remote managed services may not expose equivalent runtime tuning knobs per connection in the same way; performance behavior needs re-baselining.</li>
</ul>
<h3>6.3 Checkpoint semantics</h3>
<ul>
<li>Checkpoints are app-level snapshots of <code>memory_index</code> plus optional <code>working_memory</code>, gzipped JSON in table <code>checkpoints</code>, max 10 retained. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:20</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:157</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:171</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:195</code>)</li>
<li>Restore is transaction-guarded with rollback safety on clear-existing mode. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:308</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:451</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:460</code>)</li>
</ul>
<p>Operational effect if migrating:</p>
<ul>
<li>App-level checkpoint guarantees can still exist, but must be validated under remote latency, replica lag, and stream errors.</li>
</ul>
<h3>6.4 CLI workflows</h3>
<ul>
<li>CLI <code>stats</code>, <code>bulk-delete</code>, <code>reindex</code>, <code>schema-downgrade</code> assume direct DB access. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:51</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:82</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:349</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:410</code>)</li>
<li>Bulk-delete safety policy relies on local checkpoint creation and transaction execution. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:256</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:262</code>, <code>.opencode/skill/system-spec-kit/mcp_server/cli.ts:298</code>)</li>
</ul>
<p>Operational effect if migrating:</p>
<ul>
<li>CLI must become backend-aware and explicit about remote/auth failure modes before production use.</li>
</ul>
<h2>7) Risk Register</h2>
<p>Scale: Probability (P), Impact (I), Detectability (D) each scored 1-5. Higher D means harder to detect early.</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Risk</th>
<th align="right">P</th>
<th align="right">I</th>
<th align="right">D</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody><tr>
<td>R1</td>
<td>Vector query incompatibility (<code>sqlite-vec</code> SQL vs native Turso vector APIs)</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="right">3</td>
<td>Introduce search capability profile and dual-path query planner; enforce parity tests before cutover.</td>
</tr>
<tr>
<td>R2</td>
<td>Consistency drift in hybrid/replica reads (cross-process visibility assumptions)</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">4</td>
<td>Add consistency-mode contract; gate sensitive reads to primary until monotonic/RYW behavior validated.</td>
</tr>
<tr>
<td>R3</td>
<td>Remote protocol stream failure (baton invalidation, idle closure) causing write/read disruption</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">3</td>
<td>Build robust stream state machine, timeout policy, idempotent retry keys, and structured telemetry.</td>
</tr>
<tr>
<td>R4</td>
<td>Operational regressions in checkpoint/restore on remote backend</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">2</td>
<td>Preserve local checkpoint path initially; add remote restore drills with automatic rollback.</td>
</tr>
<tr>
<td>R5</td>
<td>Cost surprise from usage quotas/overages</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">2</td>
<td>Add budget guardrails, query volume dashboards, and monthly forecast checks against live pricing.</td>
</tr>
<tr>
<td>R6</td>
<td>Native module/local runtime mismatch in current architecture remains an operational pain point</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">1</td>
<td>Keep rebuild checks and startup validation; not a migration blocker but baseline maintenance item.</td>
</tr>
</tbody></table>
<p>Evidence examples:</p>
<ul>
<li>Vector coupling: Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:1602</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts:2118</code>; Web: <code>https://docs.turso.tech/features/ai-and-embeddings</code></li>
<li>Baton/stream lifecycle: Local libSQL clone: <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/HTTP_V2_SPEC.md:14</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/HTTP_V2_SPEC.md:24</code>, <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/docs/HTTP_V2_SPEC.md:94</code></li>
<li>Usage blocking: Web: <code>https://docs.turso.tech/help/usage-and-billing</code></li>
</ul>
<h2>8) Cost, Latency, and Durability Caveats (Date-Sensitive)</h2>
<p>Validated on <strong>February 21, 2026</strong>. Treat these as time-sensitive and re-check before any purchase or cutover.</p>
<h3>8.1 Cost caveats</h3>
<ul>
<li>Turso pricing and quotas are plan-dependent and may differ by monthly/yearly billing frequency. (Web: <code>https://turso.tech/pricing</code>)</li>
<li>Usage docs indicate quota breaches can block queries with <code>BLOCKED</code> errors for quota-bound plans. (Web: <code>https://docs.turso.tech/help/usage-and-billing</code>)</li>
</ul>
<p>Practical decision caveat:</p>
<ul>
<li>Any migration business case must include expected rows-read/rows-written/sync traffic and projected overage behavior.</li>
</ul>
<h3>8.2 Latency caveats</h3>
<ul>
<li>Turso durability page documents added commit-latency ceilings by plan tier. (Web: <code>https://docs.turso.tech/cloud/durability</code>)</li>
<li>Current local architecture avoids network RTT for all DB operations; remote/hybrid introduces network and stream lifecycle costs.</li>
</ul>
<p>Practical decision caveat:</p>
<ul>
<li>Latency comparison must be measured with this workload (search, checkpoint operations, bulk delete safety paths), not inferred from generic benchmarks.</li>
</ul>
<h3>8.3 Durability caveats</h3>
<ul>
<li>Turso documents durability model and commit acknowledgment behavior tied to object-store-backed architecture. (Web: <code>https://docs.turso.tech/cloud/durability</code>)</li>
<li>Current local system has app-level checkpoint snapshots with max retention count 10, which is not equivalent to managed PITR policies. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:20</code>, <code>.opencode/skill/system-spec-kit/mcp_server/lib/storage/checkpoints.ts:195</code>)</li>
<li>Turso PITR is available with plan-dependent retention windows. (Web: <code>https://docs.turso.tech/features/point-in-time-recovery</code>)</li>
</ul>
<p>Practical decision caveat:</p>
<ul>
<li>Managed durability can be stronger than current local defaults, but only if cost and operational controls are configured and monitored correctly.</li>
</ul>
<h2>9) Final Technical Conclusion: Portable Now vs Redesign Required</h2>
<h3>9.1 Portable now (partial)</h3>
<ul>
<li>Base SQLite data file compatibility is favorable in principle. (Local libSQL clone: <code>specs/003-system-spec-kit/140-sqlite-to-libsql/context/libsql-main/README.md:126</code>)</li>
<li>FTS5 capability alignment appears feasible with validation. (Local: <code>.opencode/skill/system-spec-kit/mcp_server/lib/search/sqlite-fts.ts:51</code>; Web: <code>https://docs.turso.tech/features/sqlite-extensions</code>)</li>
</ul>
<h3>9.2 Redesign required before backend switch</h3>
<ul>
<li>Runtime API abstraction boundary for DB and transactions.</li>
<li>Search abstraction for vector backend differences (sqlite-vec vs native vector APIs).</li>
<li>Consistency-mode aware read/write semantics and explicit stream lifecycle handling.</li>
<li>Backend-aware CLI/checkpoint operational model.</li>
</ul>
<h3>9.3 Decision posture</h3>
<p><strong>Recommendation now:</strong> Keep current local SQLite architecture as default production path for this MCP server.</p>
<p><strong>Future migration readiness:</strong> Plan an adapter-first phased migration only when explicit triggers are hit (shared remote access requirements, durability/compliance needs, or operational incidents surpassing defined thresholds), with shadow-read and dual-write safety gates before cutover.</p>
<hr>
<h2>Official Online Source URLs (Validated February 21, 2026)</h2>
<p>These URLs are intentionally repeated for implementation planning and re-validation.</p>
<ul>
<li>Turso SDK (TypeScript reference): <code>https://docs.turso.tech/sdk/ts/reference</code></li>
<li>Turso SDK quickstart (TypeScript): <code>https://docs.turso.tech/sdk/ts</code></li>
<li>Authentication (SDK): <code>https://docs.turso.tech/sdk/authentication</code></li>
<li>Authentication (Platform API): <code>https://docs.turso.tech/api-reference/authentication</code></li>
<li>libSQL Remote HTTP protocol reference: <code>https://docs.turso.tech/sdk/http/reference</code></li>
<li>Migration to Turso: <code>https://docs.turso.tech/cloud/migrate-to-turso</code></li>
<li>Durability guarantees: <code>https://docs.turso.tech/cloud/durability</code></li>
<li>SQLite extensions (FTS5, optional sqlite-vec): <code>https://docs.turso.tech/features/sqlite-extensions</code></li>
<li>Native vector search: <code>https://docs.turso.tech/features/ai-and-embeddings</code></li>
<li>Embedded replicas intro: <code>https://docs.turso.tech/features/embedded-replicas/introduction</code></li>
<li>Turso Sync usage: <code>https://docs.turso.tech/sync/usage</code></li>
<li>Pricing: <code>https://turso.tech/pricing</code></li>
<li>Usage and billing behavior: <code>https://docs.turso.tech/help/usage-and-billing</code></li>
<li>CLI plan usage visibility: <code>https://docs.turso.tech/cli/plan/show</code></li>
</ul>

    </article>
  </main>
</div>
<script src="https://cdn.jsdelivr.net/npm/animejs@3.2.2/lib/anime.min.js"></script>
<script>
(function () {
  const content = document.getElementById('content');
  const toc = document.getElementById('toc');
  if (!content || !toc) return;

  const slug = (t) => t.toLowerCase().replace(/`/g, '').replace(/[^a-z0-9\s-]/g, '').trim().replace(/\s+/g, '-');
  const seen = new Map();
  const headings = content.querySelectorAll('h2, h3');

  headings.forEach((h) => {
    let id = h.id || slug(h.textContent || 'section');
    const n = seen.get(id) || 0;
    seen.set(id, n + 1);
    if (n > 0) id = `${id}-${n + 1}`;
    h.id = id;

    const li = document.createElement('li');
    const a = document.createElement('a');
    if (h.tagName.toLowerCase() === 'h3') a.classList.add('h3');
    a.href = `#${id}`;
    a.textContent = h.textContent || id;
    li.appendChild(a);
    toc.appendChild(li);
  });

  content.querySelectorAll('table').forEach((table) => {
    const wrap = document.createElement('div');
    wrap.className = 'table-scroll';
    table.parentNode.insertBefore(wrap, table);
    wrap.appendChild(table);
  });

  content.querySelectorAll('a[href^="http://"], a[href^="https://"]').forEach((a) => {
    a.target = '_blank';
    a.rel = 'noopener noreferrer';
  });

  const animTargets = content.querySelectorAll('h2, h3, p, ul, ol, pre, blockquote, .table-scroll');
  animTargets.forEach((el, i) => {
    el.classList.add('anim');
    el.style.setProperty('--i', String(i));
  });
})();
</script>
</body>
</html>
