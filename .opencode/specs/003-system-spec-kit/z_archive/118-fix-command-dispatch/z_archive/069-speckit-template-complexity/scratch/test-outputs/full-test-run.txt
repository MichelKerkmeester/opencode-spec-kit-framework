
[0;34mâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—[0m
[0;34mâ•‘       SpecKit Template Complexity - Test Suite               â•‘[0m
[0;34mâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m

[0;34mâ”€â”€â”€ JavaScript Tests â”€â”€â”€[0m

[1;33mâ–¶ Running: Complexity Detector[0m

=== Complexity Detector Tests ===

Basic Detection:
  âœ“ detect returns object with required fields
  âœ“ detect simple task returns Level 1
  âœ“ detect complex auth task detects risk
  âœ“ detect multi-agent task detects coordination

Input Validation:
  âœ“ detect throws for non-string input
  âœ“ detect handles empty string gracefully
  âœ“ detect handles whitespace-only string

Score Ranges:
  âœ“ totalScore is between 0 and 100
  âœ“ confidence is between 50 and 95

Level Mapping:
  âœ“ score 0-25 maps to Level 1

Breakdown Structure:
  âœ“ breakdown has all 5 dimensions
  âœ“ each dimension has score, weight, and triggers

Quick Detect:
  âœ“ quickDetect returns simplified result

Format Result:
  âœ“ formatResult returns string

Dimension Detection:
  âœ“ detects scope signals from LOC mentions
  âœ“ detects risk signals from security keywords
  âœ“ detects research signals from investigation keywords
  âœ“ detects coordination signals from dependency keywords

Weight Verification:
  âœ“ weights sum to 100
  âœ“ scope weight is 25
  âœ“ risk weight is 25
  âœ“ research weight is 20
  âœ“ multiAgent weight is 15
  âœ“ coordination weight is 15
  âœ“ weightedScore calculation is correct

Level Mapping (Explicit):
  âœ“ score 26-55 maps to Level 2
  âœ“ score 56-79 maps to Level 3
  âœ“ score 80+ maps to Level 3+

Edge Cases:
  âœ“ handles very long input
  âœ“ handles special characters
  âœ“ handles unicode

=== Summary ===
Passed: 31
Failed: 0
  [0;32mâœ“ PASSED[0m (31 tests)

[1;33mâ–¶ Running: Marker Parser[0m

=== Marker Parser Tests ===

parseConditions:
  âœ“ parses level>=2 condition
  âœ“ parses level>=3+ condition
  âœ“ parses level<=3 condition
  âœ“ parses feature=ai-protocol condition
  âœ“ parses specType=research condition
  âœ“ parses combined conditions
  âœ“ handles empty string
  âœ“ handles null input
  âœ“ handles undefined input

evaluateConditions:
  âœ“ level>=2 includes for level 2
  âœ“ level>=2 includes for level 3
  âœ“ level>=3 excludes for level 2
  âœ“ level>=3+ includes for level 3+
  âœ“ evaluates default context correctly

findBlocks:
  âœ“ finds single block
  âœ“ finds multiple blocks
  âœ“ handles empty template
  âœ“ handles template with no markers

processTemplate:
  âœ“ includes block for matching level
  âœ“ excludes block for non-matching level
  âœ“ handles mixed inclusion/exclusion
  âœ“ reports stats correctly

validateMarkers:
  âœ“ validates balanced markers as valid
  âœ“ detects unbalanced markers
  âœ“ handles template without markers

levelToNumber:
  âœ“ converts "1" to 1
  âœ“ converts "2" to 2
  âœ“ converts "3" to 3
  âœ“ converts "3+" to 4
  âœ“ converts number 2 to 2
  âœ“ defaults invalid input to 1

exactLevel condition:
  âœ“ parses level=2 exact condition
  âœ“ parses level=3 exact condition
  âœ“ exact level takes precedence over range when alone
  âœ“ evaluates exactLevel correctly for match
  âœ“ evaluates exactLevel correctly for mismatch

shouldAutoEnableFeature (via evaluateConditions):
  âœ“ ai-protocol auto-enabled at Level 3
  âœ“ ai-protocol NOT auto-enabled at Level 2
  âœ“ dependency-graph auto-enabled at Level 2
  âœ“ dependency-graph NOT auto-enabled at Level 1
  âœ“ effort-estimation auto-enabled at Level 2
  âœ“ extended-checklist auto-enabled at Level 3+ only
  âœ“ executive-summary auto-enabled at Level 3
  âœ“ workstreams auto-enabled at Level 3
  âœ“ milestones auto-enabled at Level 2
  âœ“ unknown feature not auto-enabled
  âœ“ explicitly enabled feature overrides auto-enable

Edge Cases (level>= regex):
  âœ“ handles level>=2 in template correctly
  âœ“ handles level>=3, feature=x correctly

=== Summary ===
Passed: 49
Failed: 0
  [0;32mâœ“ PASSED[0m (49 tests)

[1;33mâ–¶ Running: Template Preprocessor[0m

=== Preprocessor Tests ===

loadTemplate:
  âœ“ throws for non-existent file
  âœ“ throws for empty path
  âœ“ throws for null path
  âœ“ loads existing template

preprocess:
  âœ“ throws for non-string content
  âœ“ handles empty content
  âœ“ returns content without markers unchanged
  âœ“ processes COMPLEXITY_GATE markers for Level 2
  âœ“ processes COMPLEXITY_GATE markers for Level 3
  âœ“ handles null context
  âœ“ handles empty context
preprocess: Unknown level "invalid", defaulting to "2"
  âœ“ warns for invalid level
  âœ“ returns stats in result
  âœ“ returns validation in result

expand:
  âœ“ expand loads and processes template
  âœ“ expand accepts level option

injectComplexityMetadata:
  âœ“ returns content unchanged when no complexityScore
  âœ“ returns content unchanged when complexityScore is null
  âœ“ injects metadata when complexityScore provided

INJECTION_POINTS:
  âœ“ has spec.md injection points
  âœ“ has plan.md injection points
  âœ“ has tasks.md injection points
  âœ“ has checklist.md injection points

Edge Cases:
  âœ“ handles content with special characters
  âœ“ handles deeply nested content
  âœ“ handles markers with extra whitespace

=== Summary ===
Passed: 26
Failed: 0
  [0;32mâœ“ PASSED[0m (26 tests)

[1;33mâ–¶ Running: Classifier & Features[0m

=== Classifier & Features Tests ===

Level Boundary Thresholds:
  âœ“ score 0 maps to Level 1
  âœ“ score 25 maps to Level 1 (upper boundary)
  âœ“ score 26 maps to Level 2 (lower boundary)
  âœ“ score 55 maps to Level 2 (upper boundary)
  âœ“ score 56 maps to Level 3 (lower boundary)
  âœ“ score 79 maps to Level 3 (upper boundary)
  âœ“ score 80 maps to Level 3+ (lower boundary)
  âœ“ score 100 maps to Level 3+

Distance Calculations:
  âœ“ Level 1 has distance to Level 2
  âœ“ Level 2 has distance to Level 3
  âœ“ Level 3 has distance to Level 3+
  âœ“ Level 3+ has null distance to next
  âœ“ Level 2 has distance from Level 1
  âœ“ Level 1 has null distance to prev

Boundary Proximity:
  âœ“ score near boundary is detected
  âœ“ score far from boundary is not flagged
  âœ“ score exactly at boundary is near

Level Names:
  âœ“ Level 1 is named "Baseline"
  âœ“ Level 2 is named "Verification"
  âœ“ Level 3 is named "Full"
  âœ“ Level 3+ is named "Extended"

Level Requirements:
  âœ“ Level 1 requires base files
  âœ“ Level 2 requires checklist.md
  âœ“ Level 3 requires decision-record.md
  âœ“ Level 3+ requires decision-record.md

Feature Availability:
  âœ“ aiProtocol not available at Level 1
  âœ“ aiProtocol not available at Level 2
  âœ“ aiProtocol available at Level 3
  âœ“ aiProtocol available at Level 3+
  âœ“ dependencyGraph available at Level 2
  âœ“ dependencyGraph not available at Level 1
  âœ“ extendedChecklist only at Level 3+

Feature Requirements:
  âœ“ aiProtocol required at Level 3+
  âœ“ aiProtocol not required at Level 3
  âœ“ extendedChecklist required at Level 3+
  âœ“ workstreamOrganization required at Level 3+

Spec Type Filtering:
  âœ“ researchMethodology available for research specs
  âœ“ researchMethodology not for feature specs

Gate Expressions:
  âœ“ buildGateExpression creates correct expression
  âœ“ parseGateExpression parses level>=3
  âœ“ parseGateExpression parses feature
  âœ“ parseGateExpression parses combined

Gate Evaluation:
  âœ“ evaluateGate passes for matching level
  âœ“ evaluateGate fails for insufficient level
  âœ“ evaluateGate handles maxLevel
  âœ“ evaluateGate handles 3+ as level 4

Suggest Adjustment:
  âœ“ suggests upgrade for many user stories
  âœ“ suggests downgrade for few user stories
  âœ“ no adjustment for appropriate content

=== Summary ===
Passed: 49
Failed: 0
  [0;32mâœ“ PASSED[0m (49 tests)

[0;34mâ”€â”€â”€ CLI Script Tests â”€â”€â”€[0m

[1;33mâ–¶ Running: CLI Scripts[0m

=== detect-complexity.js Tests ===

Basic Detection:
Running: Simple task returns Level 1
  âœ“ Simple task returns Level 1
Running: JSON output includes required fields
  âœ“ JSON output includes required fields
Running: Help flag shows usage
  âœ“ Help flag shows usage

Input Validation:
Running: No arguments shows error
  âœ“ No arguments shows error
Running: Empty request shows error
  âœ“ Empty request shows error
Running: Non-existent file shows error
  âœ“ Non-existent file shows error
Running: Valid file input works
  âœ“ Valid file input works
Running: File input with JSON output
  âœ“ File input with JSON output

Complex Detection:
Running: Auth task has risk score > 0
  âœ“ Auth task has risk score > 0
Running: Multi-agent task detected
  âœ“ Multi-agent task detected

=== expand-template.js Tests ===

Basic Operations:
Running: Help flag shows usage
  âœ“ Help flag shows usage
Running: Dry run mode works
  âœ“ Dry run mode works

Input Validation:
Running: No arguments shows error
  âœ“ No arguments shows error
Running: --all without --spec-folder shows error
  âœ“ --all without --spec-folder shows error

Level Handling:
Running: Accepts level 1
  âœ“ Accepts level 1
Running: Accepts level 3+
  âœ“ Accepts level 3+

=== Summary ===
Passed: 16
Failed: 0
  [0;32mâœ“ PASSED[0m (16 tests)

[0;34mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m

[0;34mSUMMARY[0m

  Test Suites: 5 passed, 0 failed
  Total Tests: 171 passed, 0 failed

[0;32mâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—[0m
[0;32mâ•‘                    ALL TESTS PASSED âœ“                        â•‘[0m
[0;32mâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
