# v2.2.0.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.2.0.0**] - 2026-02-20

**Hybrid RAG memory retrieval** with full feature coverage from spec 136: typed retrieval trace, artifact-aware routing, adaptive fusion, append-only mutation ledger, extended telemetry, extraction/config hardening, and final deferred-suite closure.

> Related spec: `.opencode/specs/003-system-spec-kit/136-mcp-working-memory-hybrid-rag/`

---

## Highlights

### Category: Testing

- **Deferred suites activated**: `api-key-validation`, `api-validation`, and `lazy-loading` moved from deferred placeholders to active tests.
- **Targeted verification**: 3 passed files, 15 passed tests, 0 skipped.
- **All-features verification**: 142 passed files (142 total), 4415 passed tests, 19 skipped (4434 total).

### Category: Retrieval and Ranking

- **Typed retrieval trace shipped**: all retrieval responses now include a typed `ContextEnvelope` with per-stage trace and degraded-mode contract metadata.
- **Artifact-aware routing shipped**: the engine now classifies and routes across 9 artifact classes with deterministic strategy tables.
- **Adaptive hybrid fusion shipped**: intent-aware fusion profiles for 7 task intents (`fix_bug`, `add_feature`, `understand`, `refactor`, `security_audit`, `find_spec`, `find_decision`) with dark-run comparison support.
- **Feature-flag safety model retained**: adaptive fusion remains opt-in (`SPECKIT_ADAPTIVE_FUSION` default off) while extended telemetry remains enabled by default.

### Category: Auditability and Observability

- **Append-only mutation ledger shipped**: memory mutations are recorded through immutable SQLite-trigger enforcement and hash-chain linkage.
- **Extended telemetry shipped**: retrieval now tracks latency, mode, fallback, and quality-proxy dimensions for search/context flows.

### Category: Hardening

- **Extraction/provenance hardening shipped**: deterministic extraction `memory_id` fallback, bounded causal-seed input, and canonical boost import-path normalization.
- **Configuration safety hardening shipped**: cognitive config parsing moved to Zod validation and LRU eviction ordering is deterministic under load.
- **Embedding-provider drift closure**: legacy `lib/interfaces/embedding-provider` path usage is now historical only, with active tests aligned to shared contracts.

### Category: Documentation

- **Root spec evidence synchronized**: Updated `test-results.md`, `implementation-summary.md`, and `checklist.md` in spec 136 with current totals and closure state.
- **Addendum closure finalized**: Updated package `007-documentation-alignment` status and evidence records.
- **CHK-336 closed**: Added "Last Verified" rows to module-count/stat tables in system-spec-kit skill and MCP documentation.

### Category: Versioning

- **Component changelog added**: `.opencode/changelog/01--system-spec-kit/v2.2.24.0.md`.
- **Skill version bump**: `.opencode/skill/system-spec-kit/SKILL.md` from `2.2.23.0` to `2.2.24.0`.

### Category: Delivery and Governance

- **Dark-launch verification completed**: baseline path validated with feature flags disabled (99.65% pass rate, 15 expected cognitive-feature failures).
- **Staged rollout completed**: 10% -> 50% -> 100% gates completed with monotonic failure reduction (20 -> 7 -> 1).
- **Governance sign-off completed**: technical, data, and product approval packets closed, with 13 success criteria passing and 23 requirements mapped to evidence.
- **Outcome confirmation completed**: 14-day KPI closure recorded 12/12 measurable KPIs passing with margin, and capability truth-matrix review recorded no declared capability drift.
- **Wave 3 survey framework included**: administrative user-survey framework artifacts are included in closure evidence.

## Files Changed

- `.opencode/skill/system-spec-kit/mcp_server/tests/api-key-validation.vitest.ts`
- `.opencode/skill/system-spec-kit/mcp_server/tests/api-validation.vitest.ts`
- `.opencode/skill/system-spec-kit/mcp_server/tests/lazy-loading.vitest.ts`
- `.opencode/skill/system-spec-kit/mcp_server/lib/{contracts,search,storage,telemetry,extraction,cognitive,config}/**`
- `.opencode/skill/system-spec-kit/mcp_server/handlers/{memory-search,memory-context,memory-save}.ts`
- `.opencode/specs/003-system-spec-kit/136-mcp-working-memory-hybrid-rag/*.md`
- `.opencode/specs/003-system-spec-kit/136-mcp-working-memory-hybrid-rag/007-documentation-alignment/*.md`
- `.opencode/skill/system-spec-kit/{SKILL.md,README.md}`
- `.opencode/skill/system-spec-kit/mcp_server/{README.md,lib/README.md}`
- `.opencode/changelog/01--system-spec-kit/v2.2.24.0.md`
- `.opencode/changelog/00--opencode-environment/v2.2.0.0.md`

## Upgrade

No migration is required. Pull latest to get the activated suite coverage and updated verification/release documentation.
