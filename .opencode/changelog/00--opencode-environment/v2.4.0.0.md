# v2.4.0.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.4.0.0**] - 2026-02-24

**Comprehensive SpecKit + Review + Agents consolidation release** -- Aggregates **11 component releases**: `01--system-spec-kit` **v2.3.0.2, v2.3.0.3, v2.3.0.4, v2.3.0.5, v2.3.0.6, v2.3.0.8, v2.3.0.9, v2.3.0.10, v2.3.0.11**, `09--sk-code--review` **v1.1.0.0**, and `02--agents-md` **v2.1.0.0**. This roll-up captures deep detail for Spec `139-hybrid-rag-fusion`, Spec `138-spec-kit-phase-system`, and Spec `041-code-review-skill`, plus AGENTS.md structural modernization.

---

## Highlights

### Category: Spec 139 Hybrid RAG Fusion (Detailed Roll-Up)

- **Phase 002 (Workstream A baseline)**: tri-channel retrieval (vector + FTS5/BM25 + graph), intent-adaptive fusion, MMR reranking, and evidence-gap signaling became the active memory search baseline; deep-mode deterministic query expansion was added.
- **Phase 003 (index/tier anomalies)**: alias-root duplication (`specs/` vs `.opencode/specs/`) was fixed through canonical-path dedup and unique merged-set enforcement; tier precedence was standardized to `metadata -> inline marker -> default`.
- **Phase 004 (frontmatter indexing)**: canonical frontmatter normalization plus dry-run/apply migration and deterministic reindex flow were completed with idempotency proof (`changed 0 / unchanged 1789 / failed 0`).
- **Phase 005 (auto-detected session bug)**: folder/session detection hardening now prefers active non-archived candidates, normalizes path aliases, and applies safe low-confidence behavior.
- **Phase 001 (deprecation closure)**: SGQS/readme-indexing/skill-ref deprecation closure was fully documented with merge-manifest governance and verification evidence.
- **Phase 006 (logic improvements)**: ten-subsystem hardening (retrieval, scoring, session quality, CRUD/index integrity, parser continuity, storage recovery, telemetry, ops validation) reached documented closure with command-backed evidence.
- **Phase 007 (template policy)**: documentation-policy enforcement pass removed disallowed ToC blocks in scoped standard artifacts and recorded bounded out-of-scope validation debt.
- **Phase 008 (code quality completion)**: baseline defect triad stabilization, moderate modularization, README modernization, and final verification matrix closure were documented with phase continuity from prior work.

### Category: Spec 138 Phase System

- **Phase-aware lifecycle introduced**: recommendation scoring (`--recommend-phases`), phase creation (`--phase`, `--phases`, `--phase-names`), and parent/child metadata linkage are integrated.
- **Command and routing integration completed**: `/spec_kit:phase` plus updates to `/spec_kit:plan`, `/spec_kit:implement`, `/spec_kit:complete`, and `/spec_kit:resume` are documented in shipped state.
- **Recursive validation path added**: `validate.sh --recursive` and phase-link rule checks now support parent/child phase trees.
- **Status clarity retained**: implementation breadth is documented as `31/34` completed with open fixture backlog (`T005`, `T028`, `T033`).

### Category: Spec 041 Code Review Skill

- **`sk-code--review` promoted as baseline review skill**: introduced as first-class package with findings-first severity analysis.
- **Baseline + overlay contract formalized**: review flow is baseline-first, then exactly one overlay, preserving mandatory minimum security/correctness requirements.
- **Runtime routing integration completed**: review intent routing was aligned across orchestrator/runtime surfaces while preserving existing git and visual-review routes.

### Category: Validation and Quality Evidence

- **Hybrid RAG baseline health recorded**: verification evidence includes `4,546 passed`, `19 skipped`, `0 failed` for the shipped baseline window.
- **Index/tier remediation evidence recorded**: targeted (`52`) and extended (`186`) regression suites passed with scoped lint/spec validation.
- **Session detector evidence recorded**: functional regression suite passed (`32 passed, 0 failed, 0 skipped`) with review gate pass.
- **Phase 006 closure evidence recorded**: full suite/lint/targeted-path validation and runbook drills are documented with closure state `P0=0`, `P1=0`.
- **Phase 008 closure evidence recorded**: typecheck, full test/lint matrix, alignment-drift checks, and validation suites are documented as passing.

### Category: Agents Documentation Consolidation

- **AGENTS.md structure modernized**: gate presentation moved from ASCII box blocks to compact markdown structure while preserving rule intent.
- **Section topology consolidated**: top-level section structure was normalized from 9 to 8 with cross-reference realignment.
- **Runtime-neutral companion added**: `AGENTS_FULL_STACK.md` was added as anonymized full-stack guidance derived from existing skill standards.

## Included Component Releases

- `.opencode/changelog/01--system-spec-kit/v2.3.0.2.md`
- `.opencode/changelog/01--system-spec-kit/v2.3.0.3.md`
- `.opencode/changelog/01--system-spec-kit/v2.3.0.4.md`
- `.opencode/changelog/01--system-spec-kit/v2.3.0.5.md`
- `.opencode/changelog/01--system-spec-kit/v2.3.0.6.md`
- `.opencode/changelog/01--system-spec-kit/v2.3.0.8.md`
- `.opencode/changelog/01--system-spec-kit/v2.3.0.9.md`
- `.opencode/changelog/01--system-spec-kit/v2.3.0.10.md`
- `.opencode/changelog/01--system-spec-kit/v2.3.0.11.md`
- `.opencode/changelog/09--sk-code--review/v1.1.0.0.md`
- `.opencode/changelog/02--agents-md/v2.1.0.0.md`

## Files Changed (Key Aggregate Scope)

- `.opencode/skill/system-spec-kit/mcp_server/lib/search/hybrid-search.ts` · `.opencode/skill/system-spec-kit/mcp_server/lib/search/adaptive-fusion.ts` · `.opencode/skill/system-spec-kit/mcp_server/lib/search/co-activation.ts` · `.opencode/skill/system-spec-kit/mcp_server/lib/search/mmr-reranker.ts` · `.opencode/skill/system-spec-kit/mcp_server/lib/search/evidence-gap-detector.ts` · `.opencode/skill/system-spec-kit/mcp_server/lib/search/query-expander.ts`
- `.opencode/skill/system-spec-kit/mcp_server/lib/parsing/memory-parser.ts` · `.opencode/skill/system-spec-kit/mcp_server/handlers/memory-index.ts` · `.opencode/skill/system-spec-kit/mcp_server/lib/scoring/importance-tiers.ts` · `.opencode/skill/system-spec-kit/scripts/lib/frontmatter-migration.ts` · `.opencode/skill/system-spec-kit/scripts/dist/memory/backfill-frontmatter.js` · `.opencode/skill/system-spec-kit/scripts/spec-folder/folder-detector.ts`
- `.opencode/skill/system-spec-kit/mcp_server/lib/storage/sqlite-transaction-recovery.ts` · `.opencode/skill/system-spec-kit/mcp_server/lib/storage/mutation-ledger.ts` · `.opencode/skill/system-spec-kit/mcp_server/lib/telemetry/trace-schema.ts` · `.opencode/skill/system-spec-kit/scripts/spec-folder/alignment-validator.ts`
- `.opencode/skill/system-spec-kit/scripts/spec/recommend-level.sh` · `.opencode/skill/system-spec-kit/scripts/spec/create.sh` · `.opencode/skill/system-spec-kit/scripts/spec/validate.sh` · `.opencode/skill/system-spec-kit/scripts/rules/check-phase-links.sh`
- `.opencode/command/spec_kit/phase.md` · `.opencode/command/spec_kit/plan.md` · `.opencode/command/spec_kit/resume.md` · `.opencode/command/spec_kit/handover.md`
- `.opencode/skill/sk-code--review/SKILL.md` · `.opencode/skill/sk-code--review/README.md` · `.opencode/skill/sk-code--review/references/security_checklist.md` · `.opencode/skill/sk-code--review/references/code_quality_checklist.md` · `.opencode/skill/sk-code--review/references/solid_checklist.md` · `.opencode/skill/sk-code--review/references/removal_plan.md`
- `AGENTS.md`
- `CLAUDE.md`
- `AGENTS_FULL_STACK.md`

## Upgrade

1. Pull latest changes.
2. Restart MCP services to activate retrieval/index/session-selection, parser, and telemetry updates.
3. For frontmatter operations, keep migration order `normalize -> verify -> rebuild`; dry-run first, then apply, then reindex.
4. For phased specs, use `--recommend-phases`, `--phase`, and `validate.sh --recursive` with parent/child linkage checks.
5. For review workflows, pull latest to use the `sk-code--review` baseline + overlay contract and findings-first output structure.
6. For AGENTS.md consumers, no behavior migration is required; structure is condensed and references are centralized.
7. No database schema migration is required; deferred follow-up items remain documented in component changelogs.
