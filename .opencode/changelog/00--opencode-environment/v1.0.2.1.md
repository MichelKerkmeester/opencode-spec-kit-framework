# v1.0.2.1

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**1.0.2.1**] - 2025-12-31

**Comprehensive System Hardening** â€” Critical embedding dimension fixes, security hardening, and performance optimizations for Spec Kit Memory system.

> Spec folder: `003-memory-system-hardening`

---

## Highlights

### Fixed

- **Embedding Dimension Mismatch** (Critical): Checkpoints now use dynamic dimension detection instead of hardcoded 768, fixing failures with Voyage (1024) and OpenAI (1536) providers
- **Dimension Detection** (Critical): `getEmbeddingDimension()` now correctly detects dimension from provider, environment variables, or API keys before falling back to default
- **Memory Indexing Failures**: Fixed dimension validation mismatches
- **Error Handling**: Empty catch blocks (2 fixed) now properly log errors instead of silently swallowing them
- **Async I/O**: Blocking file I/O replaced with async `fs.promises.readFile`
- **Documentation**: Stale references to deleted files removed
- **Architecture**: Corrected folder paths in diagrams
- **Version Sync**: Fixed version inconsistencies in context-server.js (now 16.0.0)

### New

- **Embedding Cache**: LRU cache (1000 entries) reduces redundant API calls
- **Shared Utilities**: `shared/utils.js` consolidated `validateFilePath` and `escapeRegex` utilities
- **Parallel Embeddings**: 3-5x faster with configurable concurrency (default: 5)
- **Test Fixtures**: 37 files across 10 folders for validation testing
- **Unicode Normalization**: Improved trigger phrase matching
- **Constitutional Scanning**: Auto-scanning in `memory_index_scan`
- **Dry Run Preview**: `dryRun` parameter for `memory_delete` to preview before executing
- **Validation Scripts**: `check-folder-naming.sh`, `check-frontmatter.sh`
- **Help Flag**: `--help` flag for `generate-context.js`
- **Tool Documentation**: 8 missing MCP tools documented in SKILL.md (now 14 total)

### Changed

- **Lib Consolidation**: Shared modules moved to `shared/` folder with re-export wrappers for backward compatibility
- **Path Portability**: All hardcoded paths now use environment variables
- **Validator Cleanup**: Deprecated JS validators removed (bash validators preferred)
- **Metadata Standardization**: Template metadata formats standardized

### Security

- **CWE-22**: Added path validation to CLI `CONFIG.DATA_FILE`
- **CWE-22**: Added `validateFilePath()` checks for DB-stored paths
- **CWE-400**: Added input length limits to MCP handler parameters
- **Path Sanitization**: Removed personal path references from public release
- **Symlink Fix**: Fixed symlinks pointing to personal directories

## Files Changed

- `lib/memory/checkpoint-manager.js` (critical fix)
- `lib/shared/utils.js` (new)
- `lib/memory/parallel-embedder.js` (performance)
- `scripts/validate/check-folder-naming.sh` (new)
- `scripts/validate/check-frontmatter.sh` (new)
- Multiple SKILL.md files (documentation)

## Upgrade

**Recommended immediately** for production systems. Fixes critical embedding dimension issues and security vulnerabilities.
