# v1.0.2.4

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**1.0.2.4**] - 2026-01-01

**Major Infrastructure Release** — Critical bug fixes, security hardening, MCP install automation, and comprehensive codebase standardization across 70+ files. Adds sub-agent delegation for token efficiency and universal stack-agnostic debugging.

---

## Highlights

### Security

- **CWE-22**: Path traversal protection in CLI `CONFIG.DATA_FILE` and DB-stored paths
- **CWE-400**: Input length limits for MCP tool parameters (query 10K, title 500, paths 500 chars)
- **Severity Reduction**: MEDIUM severity issues reduced from 4 to 1

### Fixed - Critical Issues

- **SQLite Transaction Nesting**: Error in `memory_index_scan` - `indexMemory()` now uses composable `database.transaction()` wrapper
- **Race Condition**: Database changes weren't visible across MCP/script connections - added file-based notification with `reinitializeDatabase()`
- **Orphaned Metadata**: Failed vector insertions leaving orphaned metadata - explicit transaction control with rollback

### Fixed - High Priority Issues

- **Wrong Dimensions**: Schema created with wrong embedding dimensions before provider warmup - `getConfirmedEmbeddingDimension()` with polling
- **Cache Invalidation**: Constitutional cache didn't invalidate on external database edits - mtime tracking added
- **Rate Limiting**: State lost on server restart - persistent `config` table in SQLite
- **Stale Statements**: Stale prepared statements after database reset - `clearPreparedStatements()` in reset paths
- **Query Validation**: Whitespace-only/empty/null input handling
- **UTF-8 BOM Detection**: EF BB BF detection in memory parser
- **Cache Key Collision**: SHA256 hash-based keys
- **Non-interactive Mode**: Now fails with guidance instead of silently using defaults
- **Orphaned Vectors**: Auto-cleaned via `verifyIntegrity({ autoClean: true })`

### New Features

- **MCP Install Scripts Suite**: Shell-based installers for all 6 MCP servers with shared utilities library (33 functions)
- **Sub-agent Delegation**: `/spec_kit:handover` and `/memory:save` now delegate heavy work to sub-agents for token efficiency
- **Session Behavior Modes**: `--brief`, `--verbose`, `--debug` flags for controlling response verbosity
- **Universal Debugging**: Stack-agnostic 4-phase approach (Observe → Analyze → Hypothesize → Fix) with new reference doc
- **Auto/Confirm Modes**: 6 `/create` commands now support `:auto` and `:confirm` mode flags
- **Research Chaining**: `/spec_kit:complete` supports `:with-research` and `:auto-debug` flags
- **Configurable Scoring**: Weights for smart ranking (`smartRanking.recencyWeight`)
- **Configurable Limits**: Trigger phrase limit via `maxTriggersPerMemory`
- **Plain-language Gates**: ~50+ "STOP HERE - Wait for X" markers in 16 command files
- **Navigation Tables**: "What Next?" navigation tables in 14 commands
- **Confidence Checkpoints**: In 9 YAML workflow files

### Changed

- **References Reorganized**: 18 files moved from flat structure into 7 logical sub-folders (`config/`, `debugging/`, `memory/`, `structure/`, `templates/`, `validation/`, `workflows/`)
- **79 Internal Links Fixed** across reference documentation
- **Lib Consolidation**: Shared modules centralized in `lib/` folder with re-export wrappers
- **Asset Template Alignment**: 9 asset files standardized across 6 skill folders
- **workflows-code Skill**: Priority-based resource loading (P1/P2/P3), references reorganized into 5 sub-folders
- **Code Style Alignment**: 70 files standardized with snake_case naming, 3-line box-drawing headers, ~3,900 lines metadata removed
- **Stack-agnostic Debugging**: `/spec_kit:debug` made universal - removed frontend-specific tool references
- **Required Documentation**: `implementation-summary.md` now required for all spec levels
- **Template Priority**: Standardized to P0/P1/P2 only

## Files Changed

## Upgrade
