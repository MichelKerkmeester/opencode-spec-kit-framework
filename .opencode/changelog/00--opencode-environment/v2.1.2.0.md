# v2.1.2.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.1.2.0**] - 2026-02-17

**Gate enforcement and indexing expansion** -- Two independent changes: (1) fixed plan-to-implementation gate bypass where agents skipped Gate 3 on free-text "implement" requests after `/spec_kit:plan`, and (2) added Source #6 skill reference indexing to the Spec Kit Memory pipeline.

---

## Highlights

### Plan-to-Implementation Gate Enforcement (`04--commands/v2.0.4.0`)

Fixed a behavioral defect where the AI agent skipped all mandatory gates (Gate 1-3) when transitioning from `/spec_kit:plan` to implementation via free-text request. Three-pronged fix:

1. **AGENTS.md Gate 3 phase boundary** -- Gate 3 answers no longer carry over across workflow phases. Plan-to-implement transition re-evaluates Gate 3.
2. **Memory Save Rule scoping** -- "do NOT re-ask" instruction scoped explicitly to memory saves only, preventing over-generalization.
3. **Plan YAML enforcement** -- Both `spec_kit_plan_auto.yaml` and `spec_kit_plan_confirm.yaml` termination sections now enforce routing free-text implement requests through `/spec_kit:implement`.

### Source #6: Skill Reference Indexing (`01--system-spec-kit/v2.2.21.0`)

Added a configurable 6th source to the Spec Kit Memory indexing pipeline for `references/` and `assets/` content from `workflows-code--*` skills.

- **New config section** -- `config.jsonc` section 12 `skillReferenceIndexing` with user-editable `indexedSkills[]`
- **3 new document types** -- `skill_reference` (0.35), `skill_checklist` (0.35), `skill_asset` (0.30)
- **Discovery function** -- `findSkillReferenceFiles()` in `memory-index.ts` follows existing pattern
- **Feature gates** -- `includeSkillRefs` MCP param + `SPECKIT_INDEX_SKILL_REFS=false` env var + config toggle
- Ships with `workflows-code--web-dev` and `workflows-code--opencode` configured

## Files Changed

| Scope | Files |
|-------|-------|
| Gate enforcement | `AGENTS.md` - `.opencode/command/spec_kit/plan.md` - `.opencode/command/spec_kit/assets/spec_kit_plan_{auto,confirm}.yaml` |
| Skill ref indexing | `.opencode/skill/system-spec-kit/config/config.jsonc` - `mcp_server/lib/config/skill-ref-config.ts` (NEW) - `mcp_server/lib/parsing/memory-parser.ts` - `mcp_server/handlers/memory-save.ts` - `mcp_server/handlers/memory-index.ts` - `mcp_server/tool-schemas.ts` - `mcp_server/handlers/index.ts` |
| Tests | `mcp_server/tests/modularization.vitest.ts` - `mcp_server/tests/handler-memory-index-cooldown.vitest.ts` |

## Upgrade

1. Pull latest from `main`.
2. Restart active sessions to pick up updated AGENTS.md gate definitions.
3. For skill reference indexing: edit `config.jsonc` section 12 `indexedSkills[]` if you need different skills than the defaults.
