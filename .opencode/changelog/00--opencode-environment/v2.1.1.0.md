# v2.1.1.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.1.1.0**] - 2026-02-17

This public release consolidates unreleased framework work after `v2.0.2.3` using **15 recently active specs** and **30 recently active changelogs**. It adds Smart Router V2 rollout/refinement, Codex compatibility hardening for command stacks, sub-agent nesting controls, and System Spec Kit/Memory alignment through `system-spec-kit v2.2.20`.

> Source comparison: public latest `v2.0.2.3` release note (node_modules relocation scope)
>
> Analysis basis: last 15 active spec folders under `.opencode/specs/` and last 30 active files under `.opencode/changelog/`

---

## Highlights

### Category: Features

- **Smart Router V2 rollout**: Upgraded routing from first-hit matching to weighted classification with recursive resource discovery and stack/language-aware prioritization across core workflow/MCP skills.
- **Smart Router V2 refinement**: Added adaptive top-N handling for close-score ambiguity, synonym expansion for noisy prompts, explicit UNKNOWN fallback guidance, and benchmark-backed behavior checks.
- **Agent orchestration depth control**: Introduced nesting-depth governance to reduce over-nested dispatch chains and improve routing efficiency.

### Category: Commands

- **Codex compatibility for `spec_kit` commands**: Refactored 7 command markdown files and 11 workflow YAML files to prevent premature agent dispatch while preserving availability metadata.
- **Codex compatibility for `/create` commands**: Applied the same compatibility model across 20 create command files and aligned legacy emoji policy language.

### Category: Architecture

- **Canonical MCP memory database path**: Standardized `MEMORY_DB_PATH` usage across OpenCode, Claude, VSCode, and Codex configs to avoid split runtime memory targets.
- **Memory indexing expansion**: Extended retrieval coverage with spec-document indexing and schema/runtime hardening documented through `system-spec-kit` releases up to `v2.2.20`.
- **Cross-system alignment**: Synced root/system documentation to current implementation behavior for release consistency.

### Category: Documentation

- **Emoji enforcement removal**: Removed H2/TOC emoji enforcement and normalized heading rules across workflow and MCP documentation.
- **Smart routing standards update**: Updated documentation templates and references to the current detection-first routing structure with one authoritative pseudocode section.
- **Version/changelog normalization**: Aligned SKILL version metadata with per-skill changelog release histories.

### Category: Testing

- **Router validation coverage**: Smart Router test suite and benchmark coverage updated and passing for ambiguity-focused scenarios.
- **Spec workflow validation**: Level 3/3+ spec validation and checklist enforcement aligned with current protocol requirements.

## Files Changed

- `.opencode/agent/orchestrate.md` · `.opencode/agent/chatgpt/orchestrate.md` · `.opencode/agent/copilot/orchestrate.md`
- `.opencode/command/spec_kit/*.md` · `.opencode/command/spec_kit/assets/*.yaml`
- `.opencode/command/create/*.md` · `.opencode/command/create/assets/*.yaml`
- `.opencode/skill/workflows-code--full-stack/SKILL.md` · `.opencode/skill/workflows-code--web-dev/SKILL.md` · `.opencode/skill/workflows-code--opencode/SKILL.md` · `.opencode/skill/workflows-git/SKILL.md`
- `.opencode/skill/workflows-documentation/**` · `.opencode/skill/system-spec-kit/**`
- `.opencode/changelog/00--opencode-environment/v2.0.3.0.md` · `.opencode/changelog/00--opencode-environment/v2.0.4.0.md` · `.opencode/changelog/00--opencode-environment/v2.0.5.0.md` · `.opencode/changelog/00--opencode-environment/v2.1.0.0.md` · `.opencode/changelog/00--opencode-environment/v2.1.1.0.md`
- `opencode.json` · `.claude/mcp.json` · `.vscode/mcp.json` · `.codex/config.toml`

## Upgrade

1. Pull latest from `main`.
2. Restart active OpenCode/Claude/VSCode/Codex sessions to reload MCP environment variables and pick up canonical `MEMORY_DB_PATH`.
3. If your local MCP runtime was configured before this release, rerun install verification from `.opencode/install_guides/`.
