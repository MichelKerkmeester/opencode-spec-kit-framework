# v2.2.24.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.2.24.0**] - 2026-02-20

**Hybrid memory retrieval rollout completion and verification closure** - This release documents every shipped feature from spec 136, including typed retrieval trace, artifact-aware routing, adaptive fusion, mutation ledger, telemetry, extraction/config hardening, and final deferred-test closure.

> Spec folder: `.opencode/specs/003-system-spec-kit/136-mcp-working-memory-hybrid-rag/`

---

## Highlights

### Category: Retrieval Features

- **Typed retrieval trace shipped**: every retrieval now returns a typed `ContextEnvelope` with stage trace (candidate, filter, fusion, rerank, fallback), degraded-mode contract, and retrieval metadata.
- **Artifact-aware routing shipped**: retrieval strategy now routes across 9 artifact classes with deterministic weight tables.
- **Adaptive hybrid fusion shipped**: intent-aware fusion profiles now support `fix_bug`, `add_feature`, `understand`, `refactor`, `security_audit`, `find_spec`, and `find_decision`.
- **Dark-run comparison mode available**: adaptive behavior can be compared against deterministic fusion without changing live retrieval output.
- **Feature-flag safety model retained**: `SPECKIT_ADAPTIVE_FUSION` remains default-off and `SPECKIT_EXTENDED_TELEMETRY` remains default-on for controlled rollout behavior.

### Category: Auditability and Observability

- **Append-only mutation ledger shipped**: create/update/delete/reindex operations are recorded through SQLite trigger-enforced immutable entries with hash-chain linkage.
- **Extended telemetry shipped**: retrieval now captures latency, mode, fallback, and quality-proxy dimensions across `memory_search` and `memory_context`.

### Category: Hardening

- **Extraction and provenance hardening shipped**: deterministic `memory_id` fallback for extraction, bounded causal-seed selection, and canonical boost import-path normalization.
- **Configuration safety hardening shipped**: cognitive config parsing now uses Zod validation and working-memory eviction now enforces deterministic LRU ordering.
- **Embedding-provider architecture drift closed**: legacy `lib/interfaces/embedding-provider` references were removed from active test paths and aligned to shared provider contracts/factory.

### Category: Testing and Documentation Closure

- **Deferred suites activated**: `tests/api-key-validation.vitest.ts`, `tests/api-validation.vitest.ts`, and `tests/lazy-loading.vitest.ts` now run as active suites.
- **Targeted closure verification**: 3 passed files, 15 passed tests, 0 skipped.
- **All-features regression verification**: 142 passed files (142 total), 4415 passed tests, 19 skipped (4434 total).
- **Root and addendum docs synchronized**: spec 136 root docs and package `007-documentation-alignment` now reflect current totals and closure evidence.
- **CHK-336 closed**: added `Last Verified` rows in module-count/stat tables for skill root README, MCP server README, and MCP lib README.

### Category: Delivery and Governance

- **Dark-launch verification completed**: baseline run with all new feature flags disabled preserved expected deterministic behavior (99.65% pass rate, 15 expected cognitive-feature failures).
- **Staged rollout completed**: feature enablement progressed through 10%, 50%, and 100% gates with monotonic failure reduction (20 -> 7 -> 1) and GO decisions.
- **Governance packets completed**: technical, data, and product approval artifacts were produced, with 13 success criteria passing and 23 requirements mapped to evidence.
- **Outcome confirmation completed**: 14-day KPI monitoring closure recorded 12/12 measurable KPIs passing with margin, and capability truth-matrix review confirmed zero drift.
- **Wave 3 survey framework included**: administrative user-survey framework artifacts were included in outcome confirmation documentation.

### Category: Versioning

- **Skill version bump**: `.opencode/skill/system-spec-kit/SKILL.md` updated from `2.2.23.0` to `2.2.24.0`.

## Files Changed

| File | Change |
|------|--------|
| `.opencode/skill/system-spec-kit/mcp_server/lib/{contracts,search,storage,telemetry,extraction,cognitive,config}/**` | Retrieval, ledger, telemetry, extraction, and config hardening runtime features |
| `.opencode/skill/system-spec-kit/mcp_server/handlers/{memory-search,memory-context,memory-save}.ts` | Handler wiring for adaptive retrieval, telemetry, and mutation logging |
| `.opencode/skill/system-spec-kit/mcp_server/tests/{api-key-validation,api-validation,lazy-loading,embeddings}.vitest.ts` | Deferred drift closure and active coverage updates |
| `.opencode/specs/003-system-spec-kit/136-mcp-working-memory-hybrid-rag/{implementation-summary,test-results,checklist}.md` | Root verification sync for full feature set and closure evidence |
| `.opencode/specs/003-system-spec-kit/136-mcp-working-memory-hybrid-rag/007-documentation-alignment/*.md` | Addendum closure sync, CHK-336 closure, and status normalization |
| `.opencode/skill/system-spec-kit/{README.md,SKILL.md}` | Last verified table updates and skill version bump |
| `.opencode/skill/system-spec-kit/mcp_server/{README.md,lib/README.md}` | Module/stat table verification-date updates |

## Upgrade

No migration is required. Pull latest to get active coverage for the three formerly deferred suites and synchronized verification documentation.
