# v1.2.0.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**1.2.0.0**] - 2026-02-02

**Major release implementing SpecKit Reimagined** (Spec 082) with **33 features**, **107 tasks**, and **5 new memory commands**. Adds session deduplication, causal memory graph, intent-aware retrieval, BM25 hybrid search, and comprehensive crash recovery.

---

## Highlights

### New

- **Session Management (W-S)**
  - **Session deduplication** — Hash-based tracking prevents re-surfacing same memories (50% token savings)
  - **Crash recovery** — `session_state` table with automatic `CONTINUE_SESSION.md` generation
  - **SessionStateManager API** — `resetInterruptedSessions()`, `recoverState()` with `_recovered` flag

- **Search & Retrieval (W-R)**
  - **BM25 hybrid search** — Pure JavaScript BM25 implementation for lexical search fallback
  - **RRF fusion enhancement** — k=60 parameter with 10% convergence bonus for multi-source results
  - **Intent-aware retrieval** — 5 intent types (add_feature, fix_bug, refactor, security_audit, understand)
  - **Cross-encoder reranking** — Voyage/Cohere/local providers with length penalty (100 char threshold)
  - **Fuzzy matching** — Levenshtein distance (<=2) + ACRONYM_MAP (30+ entries)

- **Decay & Scoring (W-D)**
  - **Type-specific half-lives** — 9 memory types with distinct decay rates
  - **Multi-factor decay** — Pattern alignment and citation recency factors
  - **Usage boost scoring** — Enhanced 5-factor composite scoring
  - **Consolidation pipeline** — 5-phase duplicate detection and semantic merge

- **Causal Memory Graph (W-G)**
  - **Causal edges** — 6 relationship types (caused, enabled, supersedes, contradicts, derived_from, supports)
  - **Decision lineage** — Depth-limited traversal (max 10 hops) with cycle detection
  - **Learning from corrections** — Stability penalties (0.5x) and boosts (1.2x) for replacements

- **Infrastructure (W-I)**
  - **Recovery hints catalog** — 49 error codes with actionable recovery guidance
  - **Tool output caching** — 60s TTL with LRU eviction
  - **Lazy model loading** — Deferred embedding initialization
  - **Standardized response envelope** — `{summary, data, hints, meta}` structure
  - **Layered tool organization** — 7-layer MCP architecture (L1-L7)
  - **Incremental indexing** — Content hash + mtime-based diff updates
  - **Pre-flight quality gates** — ANCHOR validation, duplicate detection, token budget checks
  - **Protocol abstractions** — Provider-agnostic embedding interfaces
  - **API key validation** — Secure key handling with actionable guidance
  - **Fallback chain** — Primary API to Local to BM25-only with logging
  - **Deferred indexing** — Graceful degradation when embeddings fail
  - **Retry logic** — Exponential backoff (1s, 2s, 4s) with jitter
  - **Transaction atomicity** — SAVEPOINT/ROLLBACK patterns

- **Files**
  - `lib/session/session-manager.js` — Session deduplication and crash recovery (~1050 lines)
  - `lib/errors/recovery-hints.js` — 49 error codes with hints (~520 lines)
  - `lib/search/bm25-index.js` — Pure JS BM25 implementation (~380 lines)
  - `lib/search/cross-encoder.js` — Reranking with Voyage/Cohere/local (~490 lines)
  - `lib/search/intent-classifier.js` — Intent detection for 5 types
  - `lib/search/fuzzy-match.js` — Levenshtein + acronym expansion **[NEVER IMPLEMENTED]**
  - `lib/learning/corrections.js` — Memory corrections tracking (~560 lines) **[NEVER IMPLEMENTED]**
  - `lib/cognitive/archival-manager.js` — Automatic archival background job (~450 lines)
  - `lib/cognitive/consolidation.js` — 5-phase consolidation pipeline **[NEVER IMPLEMENTED]**
  - `lib/architecture/layer-definitions.js` — 7-layer MCP architecture (~320 lines)
  - `lib/embeddings/provider-chain.js` — Embedding fallback chain (~340 lines) **[NEVER IMPLEMENTED]**
  - `lib/response/envelope.js` — Standardized response structure (~280 lines)
  - `lib/storage/causal-edges.js` — Causal edge management (~529 lines)
  - `handlers/memory-context.js` — L1 Orchestration unified entry (~420 lines)
  - `handlers/causal-graph.js` — MCP handlers for causal graph (~319 lines)

- **Commands**
  - `/memory:continue` — Session recovery from crash/compaction
  - `/memory:context` — Unified entry with intent awareness
  - `/memory:why` — Decision lineage tracing via causal graph
  - `/memory:correct` — Learning from mistakes with stability penalties
  - `/memory:learn` — Explicit learning capture (patterns, pitfalls, insights)

- **MCP Tools**
  - `memory_drift_why` — Trace causal chain for "why" queries
  - `memory_causal_link` — Create causal relationships between memories
  - `memory_causal_stats` — Graph statistics and coverage metrics
  - `memory_causal_unlink` — Remove causal relationships
  - `memory_drift_context` — Unified context with intent awareness **[NEVER IMPLEMENTED -- removed from roadmap]**
  - `memory_drift_learn` — Capture explicit learning **[NEVER IMPLEMENTED -- removed from roadmap]**

### Changed

- **Database Schema**
  - **v8** — `causal_edges` table (6 relation types, strength, evidence)
  - **v9** — `memory_corrections` table (stability tracking, pattern extraction)
  - **v10** — `session_state` table (crash recovery, dirty flag)
  - **v11** — Added `is_archived`, `archived_at` columns

- **Templates**
  - **context_template.md v2.2** — CONTINUE_SESSION section, session_dedup metadata, causal_links
  - **save.md** — Phase 0 pre-flight validation, section 16 session deduplication, deferred indexing
  - **search.md** — Hybrid search architecture, intent-aware retrieval, compression tiers

- **Memory Commands**
  - All 9 memory commands updated with spec 082 cross-references
  - All 7 spec_kit commands updated with Five Checks Framework
  - 12 YAML workflow assets updated with context loading integration

### Fixed
- **folder-detector.js** — CLI arguments now take priority over alignment validation (never override explicit user intent)

## Files Changed

- **Spec Folder:** `specs/003-memory-and-spec-kit/082-speckit-reimagined/`
- **Implementation Tasks:** 107 tasks across 5 workstreams (W-S, W-R, W-D, W-G, W-I)
- **Test Coverage:** cross-encoder (22), intent-classifier (25), provider-chain (28), causal-edges (29), archival-manager (32), fuzzy-match (40), five-factor-scoring (65), tier-classifier (78); overall 83.2% (89/107 tasks)

*For full implementation details, see `082-speckit-reimagined/implementation-summary.md`*
