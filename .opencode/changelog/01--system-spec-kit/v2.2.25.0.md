# v2.2.25.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.2.25.0**] - 2026-02-20

**SQLite WAL contention fix and database maintenance** - Resolves intermittent "no such table: memory_index" errors under concurrent access, and cleans up test artifacts, stale conflicts, and missing trigger phrases.

---

## Highlights

### Category: Bug Fix

- **SQLite busy_timeout PRAGMA added**: Added `db.pragma('busy_timeout = 10000')` to database initialization in `vector-index-impl`. When multiple MCP server processes access the WAL-mode database concurrently, `sqlite3_prepare()` could fail to acquire the WAL lock during schema loading, falling back to a stale main database file with an empty schema â€” producing the "no such table: memory_index" error. The 10-second busy timeout allows concurrent readers to wait for the lock instead of failing immediately.

### Category: Database Maintenance

- **Test artifacts removed**: Deleted 67 test artifact entries (spec_folder='T') and 2 temporary-tier entries from the memory index.
- **Stale conflicts purged**: Removed 9,626 orphaned records from the `memory_conflicts` table.
- **Missing trigger phrases generated**: Auto-generated trigger phrases for 1,463 memories that had none, using title and path-based extraction.
- **Post-maintenance state**: 2,909 memories, 0 test artifacts, 0 temporary entries, 0 stale conflicts, 0 missing trigger phrases.

### Category: Incremental Re-index

- **Incremental scan completed**: 23 new files indexed, 30 updated, 1,485 unchanged (mtime-based skip).

## Files Changed

| File | Change |
|------|--------|
| `.opencode/skill/system-spec-kit/mcp_server/lib/search/vector-index-impl.ts` | Added `busy_timeout = 10000` PRAGMA after WAL journal mode |
| `.opencode/skill/system-spec-kit/mcp_server/dist/lib/search/vector-index-impl.js` | Same fix applied to compiled JS output |
| `dist/database/context-index.sqlite` | Test artifacts, temp entries, conflicts purged; trigger phrases generated |

## Upgrade

No migration required. The busy_timeout PRAGMA is applied automatically on database open. Restart any running MCP server processes to pick up the fix.
