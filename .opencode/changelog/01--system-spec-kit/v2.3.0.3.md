# v2.3.0.3

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.3.0.3**] - 2026-02-22

**Deterministic memory indexing for alias roots and tier precedence normalization** - Fixed duplicate indexing caused by `specs/` vs `.opencode/specs/` path aliasing and standardized importance-tier resolution across parser and scoring paths.

> Spec folder: `.opencode/specs/003-system-spec-kit/139-hybrid-rag-fusion/003-index-tier-anomalies/` (Level 3)

---

## Highlights

### Category: Bug Fixes

- **Canonical-path dedup in discovery**: parser file discovery now canonicalizes and deduplicates logical paths before indexing.
- **Unique merge enforcement in scan handler**: `memory-index.ts` now enforces unique merged file sets before batch processing.
- **Tier precedence normalized**: tier logic is now deterministic with precedence `metadata -> inline marker -> default`.
- **Diagnostics improved**: scan outputs now include dedup-oriented diagnostics to explain unique-vs-skipped behavior.

### Category: Testing

- **Targeted regressions passed**: parser/index/tier suites passed (`52` tests).
- **Extended regressions passed**: extended parser/spec indexing suites passed (`186` tests).
- **Scoped lint and spec validation passed**: modified runtime and test files passed scoped ESLint and spec validation checks.

### Category: Scope and Safety

- **No schema migration included**: historical row cleanup was explicitly out of scope for this spec.
- **Behavioral fix only**: change focuses on deterministic indexing and tier assignment consistency.

## Files Changed

| File | Change |
|------|--------|
| `.opencode/skill/system-spec-kit/mcp_server/lib/parsing/memory-parser.ts` | Canonical-path dedup and normalization flow |
| `.opencode/skill/system-spec-kit/mcp_server/handlers/memory-index.ts` | Unique merged file-set enforcement and dedup diagnostics |
| `.opencode/skill/system-spec-kit/mcp_server/lib/scoring/importance-tiers.ts` | Deterministic tier precedence and default mapping behavior |
| `.opencode/skill/system-spec-kit/mcp_server/tests/memory-parser.vitest.ts` | Tier precedence and parser edge-case coverage |
| `.opencode/skill/system-spec-kit/mcp_server/tests/handler-memory-index.vitest.ts` | Alias-root dedup regression coverage |
| `.opencode/skill/system-spec-kit/mcp_server/tests/importance-tiers.vitest.ts` | Tier consistency assertions |

## Upgrade

No migration is required. Restart MCP services and run a fresh index scan to confirm deduplicated scan counters and stable tier mapping in diagnostics.
