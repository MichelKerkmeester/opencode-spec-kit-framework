# v2.2.22.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.2.22.0**] - 2026-02-19

**Hybrid memory retrieval upgrade with traceability, adaptive fusion, and mutation auditing** -- Expanded the Spec Kit Memory MCP runtime with typed retrieval traces, artifact-aware routing, intent-adaptive fusion, append-only mutation logging, and extended telemetry, delivered through the Level 3+ rollout in `136-mcp-working-memory-hybrid-rag`.

> Spec folder: `.opencode/specs/003-system-spec-kit/136-mcp-working-memory-hybrid-rag/` (Level 3+)

---

## Highlights

### Category: Retrieval and Ranking

- **Typed retrieval contracts added**: Retrieval responses now carry a typed `ContextEnvelope` with explicit pipeline trace/degraded-mode metadata for explainable ranking behavior.
- **Artifact-aware routing shipped**: Search behavior now adapts by artifact class (spec, plan, decision-record, memory, research, and others) to improve relevance per document type.
- **Intent-adaptive hybrid fusion added**: Weighted fusion now supports intent-aware profiles (`fix_bug`, `add_feature`, `understand`, `refactor`, `security_audit`, `find_spec`, `find_decision`) behind feature-flag control.

### Category: Safety and Observability

- **Append-only mutation ledger introduced**: Memory CRUD and re-index operations are now captured in a tamper-evident audit trail.
- **Extended retrieval telemetry enabled**: Search/context handlers now emit richer latency, mode, fallback, and quality-proxy telemetry for evaluation and operations.
- **Cognitive config hardening**: Config parsing now uses schema-validated paths and deterministic working-memory pressure/eviction behavior.

### Category: Tooling and Test Coverage

- **New runtime modules added**: Contracts, extraction adapters, adaptive fusion, artifact routing, causal/session boost, mutation ledger, and telemetry modules landed in MCP server runtime.
- **Expanded test suite**: Added focused test files for new retrieval/routing/telemetry/ledger features and updated integration coverage.
- **Evaluation lane scripts added**: New eval/KPI scripts support staged rollout checks, quality backfill, performance benchmarks, and calibration workflows.

## Files Changed

| File | Change |
|------|--------|
| `.opencode/skill/system-spec-kit/mcp_server/context-server.ts` | Updated orchestration and retrieval wiring |
| `.opencode/skill/system-spec-kit/mcp_server/handlers/*.ts` | Extended context/search/index/save/checkpoint behavior |
| `.opencode/skill/system-spec-kit/mcp_server/lib/{contracts,extraction,search,storage,telemetry,cognitive}/**` | Added new runtime capabilities and support logic |
| `.opencode/skill/system-spec-kit/mcp_server/tests/*.vitest.ts` | Added and updated feature/integration tests |
| `.opencode/skill/system-spec-kit/scripts/{evals,kpi,extractors,memory}/**` | Added rollout, quality, and validation tooling |
| `.opencode/specs/003-system-spec-kit/136-mcp-working-memory-hybrid-rag/**` | Added rollout waves, documentation alignment, and completion artifacts |

## Upgrade

No migration is required. Pull latest to get the new retrieval/runtime capabilities. Keep `SPECKIT_ADAPTIVE_FUSION` disabled for baseline parity, then enable it deliberately when ready to trial adaptive ranking behavior.
