# v2.2.31.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.2.31.0**] - 2026-02-21

**Fix Constitutional Tier Mis-assignment in Memory Parser** -- Fixed `extractImportanceTier()` matching `importanceTier: 'constitutional'` from HTML template comments instead of the actual YAML metadata block, causing 595 SESSION SUMMARY memories to be incorrectly classified as constitutional tier.

> Spec folder: `.opencode/specs/003-system-spec-kit/140-fix-constitutional-tier` (Level 1)

---

## Highlights

### Category: Bug Fixes

- **HTML comment stripping**: Added `content.replace(/<!--[\s\S]*?-->/g, '')` to `extractImportanceTier()` before regex matching. The function previously scanned the entire file content including HTML comments, where the `context_template.md` instructional comment on line 77 (`importanceTier: 'constitutional'`) was matched before the actual YAML metadata block.
- **Bulk re-tier**: Updated 595 SESSION SUMMARY entries from `constitutional` to `normal` tier in the SQLite database. Only 2 legitimate constitutional memories (IDs 567, 568) were preserved.

### Category: Documentation

- **Parsing README**: Updated `extractImportanceTier` function description to document the HTML comment stripping behavior.

## Files Changed

| File | Change |
|------|--------|
| `.opencode/skill/system-spec-kit/mcp_server/lib/parsing/memory-parser.ts` | Strip HTML comments before tier regex matching in `extractImportanceTier()` |
| `.opencode/skill/system-spec-kit/mcp_server/dist/lib/parsing/memory-parser.js` | Compiled equivalent |
| `.opencode/skill/system-spec-kit/mcp_server/lib/parsing/README.md` | Updated function description |
| Database: `context-index.sqlite` | 595 rows: `importance_tier` changed from `constitutional` to `normal` |

## Upgrade

No action required. The parser fix takes effect immediately on next MCP server restart. Existing mis-tiered entries were already corrected via bulk SQL update.
