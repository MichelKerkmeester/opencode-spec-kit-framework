# v1.2.2.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**1.2.2.0**] - 2026-02-03

**30-agent audit bug fixes** (Spec 085) — comprehensive remediation of 34 bugs discovered by 30 parallel agents auditing Spec Kit v1.2.x. All P0/P1/P2 issues resolved.

---

## Highlights

### Fixed

- **Core Infrastructure (Agent 1)**
  - **Schema version mismatch** — Updated `SCHEMA_VERSION` from 9 to 11 in `vector-index.js:108`
  - **Duplicate error codes** — `QUERY_TOO_LONG` changed from E040 to E042, `QUERY_EMPTY` from E041 to E043 (now unique)

- **Scoring Modules (Agent 2)**
  - **Tier weight inconsistency** — Aligned `folder-scoring.js` TIER_WEIGHTS with authoritative `importance-tiers.js`
  - **Invalid tier names** — Removed non-existent "high" and "low" tiers from `composite-scoring.js` multipliers
  - **Test alignment** — Updated `five-factor-scoring.test.js` to use valid tier names

- **Extractors (Agent 3)**
  - **Null pointer crashes** — Added defensive null checks for `collected_data` and `observations` in `file-extractor.js:61-63`
  - **Process termination** — Replaced `process.exit(1)` with `throw new Error()` in `file-extractor.js:31` and `diagram-extractor.js:22,28`

- **Templates (Agents 4 & 5)**
  - **Section numbering** — Fixed `level_2/spec.md` section 10 to 7 (OPEN QUESTIONS)
  - **Progressive inheritance** — Level 3 templates now correctly inherit L2 addendum content
  - **L3+ content removal** — Removed L3+ sections from `level_3/checklist.md` (belongs only in level_3+)
  - **Double separators** — Fixed `------` to `---` in L2 and L3 templates
  - **Template comments** — Updated template source comments to reflect inheritance chain

- **Memory Commands (Agent 6)**
  - **Tool prefix standardization** — All memory commands now use full `spec_kit_memory_` prefix
  - **Files updated** — `context.md`, `manage.md`, `save.md`, `learn.md` (MCP Matrix tables and allowed-tools)

- **SKILL.md Documentation (Agent 7)**
  - **Tool table expansion** — Added 8 missing tools (14 to 22): `memory_context`, `task_preflight`, `task_postflight`, `memory_drift_why`, `memory_causal_link`, `memory_causal_stats`, `memory_causal_unlink`, `memory_get_learning_history`
  - **LOC counts** — Updated template line counts to match actual sizes (L1: 450, L2: 890, L3: 890, L3+: 1080)
  - **Path fix** — Corrected `decision-format.md` path to `validation/` subfolder

- **Error Handling (Agent 8)**
  - **False positive reduction** — Added `hasWholeWord()` and `areTermsInSameContext()` helpers to `prediction-error-gate.js` for better contradiction detection
  - **Error message clarity** — Improved `workflow.js:279-281` error message with actionable guidance

- **Shared Utilities (Agent 9)**
  - **Deduplication logic** — `trigger-extractor.js:448-499` now prefers longer, more specific phrases over shorter ones

- **Embedding Providers (Agent 10)**
  - **Provider identification** — Added `getProviderName()` method to all 3 providers (`openai.js`, `voyage.js`, `hf-local.js`)
  - **Documentation accuracy** — Fixed `utils/README.md` API documentation to match actual `process_with_retry()` parameters

All fixes independently verified: schema version 11 confirmed at `vector-index.js:108`, error codes E042/E043 confirmed unique at `core.js:40-41`, zero `process.exit()` calls in extractors, all 3 providers have `getProviderName()` method, memory commands use full tool prefixes.

## Files Changed

- **Audit Spec:** `specs/003-memory-and-spec-kit/084-speckit-30-agent-audit/`
- **Fix Spec:** `specs/003-memory-and-spec-kit/085-audit-fixes/`
- **Completion:** 34/34 bugs fixed (100%)
