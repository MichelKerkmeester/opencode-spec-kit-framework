# v2.2.22.1

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.2.22.1**] - 2026-02-19

**Memory save path-resolution hotfix for `.opencode/specs` inputs** -- Fixed `generate-context.js` folder detection so JSON `SPEC_FOLDER` values that include `.opencode/specs/...` resolve directly instead of falling through to nested auto-detection.

> Related specs: `.opencode/specs/004-agents/021-codex-orchestrate/` and `.opencode/specs/003-system-spec-kit/136-mcp-working-memory-hybrid-rag/`

---

## Highlights

### Category: Folder Detection

- **JSON spec-folder normalization added**: `detectSpecFolder()` now correctly handles absolute paths, `specs/...`, and `.opencode/specs/...` in collected data.
- **Alignment base-path corrected**: Folder-alignment checks now run against the resolved folder basename and parent directory, preventing malformed join results.
- **Symlink duplicate guard added**: Existing specs directories are de-duplicated by realpath, so `specs -> .opencode/specs` no longer appears as two competing roots.

### Category: Recovery

- **Misrouted memory recovered**: The session memory file was moved to the intended spec folder and re-indexed under `004-agents/021-codex-orchestrate`.
- **Stale index entries removed**: Wrong-folder memory rows created by fallback routing were deleted from the memory index.

## Files Changed

| File | Change |
|------|--------|
| `.opencode/skill/system-spec-kit/scripts/core/config.ts` | De-duplicate specs roots by realpath |
| `.opencode/skill/system-spec-kit/scripts/spec-folder/folder-detector.ts` | Normalize JSON `SPEC_FOLDER` path forms and fix alignment base path |
| `.opencode/specs/004-agents/021-codex-orchestrate/memory/19-02-26_17-51__codex-orchestrate.md` | Recovered and re-indexed memory in correct spec folder |

## Upgrade

No migration is required. Pull latest and use `/memory:save` with either `specs/...` or `.opencode/specs/...` folder forms.
