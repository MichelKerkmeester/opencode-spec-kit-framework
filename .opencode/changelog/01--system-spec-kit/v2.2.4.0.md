# v2.2.4.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.2.4.0**] - 2026-02-12

**4-source indexing pipeline**, **anchor prefix matching**, and **165 new tests** expanding memory system to index project READMEs alongside spec files, constitutional files, and skill READMEs.

---

## Highlights

### New
- **4-source indexing pipeline** — Memory system now indexes from spec files, constitutional files, skill READMEs, AND project READMEs (previously only 3 sources)
- **`findProjectReadmes()`** — New discovery function for project-level README.md files with importance weight 0.4
- **`includeReadmes` parameter** — Controls README scanning in `memory_index_scan` (default: true)
- **Tiered importance weights** — User work (0.5/1.0x), Project READMEs (0.4/0.9x), Skill READMEs (0.3/0.8x) with scoring formula `score *= (0.5 + importance_weight)`
- **Anchor prefix matching** — `anchors: ['summary']` now matches composite IDs like `summary-session-...` with exact-match priority and shortest-prefix fallback
- **README anchor schema** — 74 READMEs anchored with ~473 anchor tags across the project
- **YAML frontmatter support** — READMEs can include frontmatter with title, description, trigger_phrases, importance_tier
- **`.opencode/README.md`** — New directory structure documentation (245 lines, 9 sections)
- **`readme_indexing.md`** — Comprehensive reference doc for README indexing pipeline (291 lines)
- **165 new tests** — Across 8 test files covering README parsing, discovery, integration, regression, prefix matching, and anchor ID validation

### Changed
- **`context_template.md`** — Simplified all 24 anchor IDs, removed `{{SESSION_ID}}-{{SPEC_FOLDER}}` suffixes for clean semantic names
- **`findSkillReadmes()`** — Now handles symlinked READMEs (`entry.isSymbolicLink()`)
- **`search-results.ts`** — Anchor filtering supports prefix matching with hyphen-boundary enforcement
- **`memory_system.md`** — Updated from "three sources" to "four sources"
- **`save_workflow.md`** — Added project READMEs to indexed content documentation
- **`SKILL.md`** — Expanded README Content Discovery section with `findProjectReadmes()` and weight tiers
- **`mcp_server/README.md`** — Fixed 17 parameter documentation mismatches (3 phantom removed, 14 undocumented added)
- **`troubleshooting.md`** — Fixed version v1.7.1 to v1.7.2, documented dual decay model (FSRS day-based + turn-based)
- **Test statistics** — Updated from 3,872 to 4,037 tests, 114 to 120 test files
- **7 ADRs documented** — ADR-001 through ADR-007
- **85 tasks tracked** — T001-T085
- **192 checklist items** — CHK-001-192
- **README indexing audit** — 96 READMEs on disk, 93 → 94 indexed (100% coverage after symlink fix)

### Fixed
- **Anchor lookup failure** — `anchors: ['summary']` returned empty when keys were composite IDs; now uses prefix fallback
- **Anchor ID validation** — Template-generated IDs (80-120 chars with underscores) violated `VALID_ANCHOR_PATTERN`; simplified to short semantic names
- **Symlink README discovery** — `findSkillReadmes()` missed symlinked READMEs; added `isSymbolicLink()` check
- **Resume detection bugs** — 5 root causes: wrong base path in glob patterns, insufficient glob depth, wrong semantic query in tier 2, too-generic trigger in tier 3, tier skipping
- **`mcp-code-mode/README.md`** — Anchor name mismatch (`structure` → `architecture`)
- **False bug report corrected** — check-anchors.sh awk was incorrectly reported as having a `/` parsing bug; B5 audit confirmed no bug exists
