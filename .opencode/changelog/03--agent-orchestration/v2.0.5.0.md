# v2.0.5.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.0.5.0**] - 2026-02-17

**Orchestrate.md Full Restructure + Agent Sync** â€” Restructured all three orchestrate.md variants from 27 scattered sections to 10 cohesive sections organized around the orchestrator's actual decision loop. Added Nesting Depth Protocol (NDP), removed 6 aspirational sections, consolidated budget sections, condensed anti-patterns 12â†’6, added semantic emojis, replaced hardcoded skill references with wildcard, and synced all 8 agents to `.claude/agents/`.

> Spec folder: `specs/004-agents/019-incorrect-sub-agent-nesting/` (Level 3)

---

## Highlights

### Restructure (27 â†’ 10 sections)

- **New section layout** organized around decision loop: Core Workflow â†’ Agent Routing & Nesting â†’ Task Decomposition & Dispatch â†’ Mandatory Rules â†’ Output Review & Quality â†’ Failure Handling â†’ Synthesis & Delivery â†’ Budget Constraints â†’ Anti-Patterns â†’ Reference
- **NDP moved from buried Â§26 to prominent Â§2** â€” 3-tier agent classification (ORCHESTRATOR/DISPATCHER/LEAF) with absolute max depth of 3 (depth 0-1-2)
- **Budget consolidated** â€” CWB, TCB, and resource budgeting merged from 3 scattered locations into single Â§8

### Removed (6 aspirational sections)

- Â§9 Event-Driven Triggers (no trigger system exists)
- Â§17 Saga Compensation (orchestrator has no file tools)
- Â§18 Caching Layer (no caching mechanism)
- Â§20 Incremental Checkpointing (no checkpoint storage)
- Â§21 Summary (redundant with section headers)
- Â§22 Mermaid Visualization (aspirational, no implementation)

### Cross-Variant Improvements

- **Copilot Rule 2 + Rule 6 promoted to all variants** â€” expanded spec folder verification gates and routing violation detection
- **Anti-patterns condensed 12 â†’ 6** â€” removed items that merely restated existing rules
- **Variant parity**: base â†” chatgpt byte-identical; copilot 2-line frontmatter difference only

### Skill Reference Wildcard

- **`workflows-code--*`** replaces hardcoded `workflows-code--web-dev` / `workflows-code--full-stack` references across 6 agent files (3 orchestrate + 3 review)

### Semantic Emoji Alignment

- 7 emojis added aligned with context.md conventions: âœ… Legal Nesting Chains, âŒ Illegal Nesting Chains, ğŸ”’ Agent Loading Protocol, ğŸ”’ LEAF/DISPATCHER Enforcement, ğŸ”’ Review Checklist, âŒ Rejection Criteria

### Claude Code Agent Sync

- All 8 copilot agent bodies duplicated to `.claude/agents/` with CC frontmatter format
- OpenCode `permission` object â†’ CC `tools` list; `model: github-copilot/claude-*` â†’ CC `model: opus|sonnet|haiku`
- Added `mcpServers: [spec_kit_memory, code_mode]` to all CC agents

## Files Changed

| File                                     | Action                                                     |
| ---------------------------------------- | ---------------------------------------------------------- |
| `.opencode/agent/orchestrate.md`         | Modified â€” full restructure + emojis + wildcard            |
| `.opencode/agent/chatgpt/orchestrate.md` | Modified â€” identical to base                               |
| `.opencode/agent/copilot/orchestrate.md` | Modified â€” same; frontmatter without model/reasoningEffort |
| `.opencode/agent/review.md`              | Modified â€” workflows-code--* wildcard                      |
| `.opencode/agent/chatgpt/review.md`      | Modified â€” workflows-code--* wildcard                      |
| `.opencode/agent/copilot/review.md`      | Modified â€” workflows-code--* wildcard                      |
| `.claude/agents/orchestrate.md`          | Modified â€” CC sync with restructured body                  |
| `.claude/agents/context.md`              | Modified â€” CC sync with copilot body                       |
| `.claude/agents/review.md`               | Modified â€” CC sync + workflows-code--*                     |
| `.claude/agents/research.md`             | Modified â€” CC sync with copilot body                       |
| `.claude/agents/speckit.md`              | Modified â€” CC sync with copilot body                       |
| `.claude/agents/write.md`                | Modified â€” CC sync with copilot body                       |
| `.claude/agents/debug.md`                | Modified â€” CC sync with copilot body                       |
| `.claude/agents/handover.md`             | Modified â€” CC sync with copilot body                       |

**Total: 14 files modified**

## Upgrade

No action required. Pull latest to get updates. Section cross-references (Â§N) have been renumbered â€” any external documentation referencing old section numbers will need updating.
