# v2.0.3.0

> Part of [OpenCode Dev Environment](https://github.com/MichelKerkmeester/opencode-spec-kit-framework)

---

## [**2.0.3.0**] - 2026-02-17

**Codex Compatibility** â€” Refactored all 7 spec_kit command files and 11 YAML workflow files to prevent Codex (OpenAI) from prematurely dispatching agents. Three-pronged approach: strip agent content from .md files, add explicit CONSTRAINTS guards, and restructure YAML `agent_routing` to `agent_availability` with conditional language.

> Spec folder: `.opencode/specs/002-commands-and-skills/001-commands/010-speckit-codex-compatibility/` (Level 2)

---

## Highlights

### Problem

Codex misinterpreted command files in three ways:
1. Dispatched `@review` to review the workflow prompt itself
2. Dispatched `@handover` prematurely before user opt-in
3. Dispatched `@debug` without the `failure_count >= 3` condition

### Change A: Stripped Agent Content from .md Files

Removed from all 7 spec_kit .md files:
- `## AGENT ROUTING` sections (routing tables, dispatch templates, blocking/fallback behavior)
- `## SUB-AGENT DELEGATION` sections (delegation architecture, sub-agent prompts, execution flow)
- `<!-- REFERENCE ONLY -->` HTML comments and `> REFERENCE ONLY` blockquotes
- All `### @agent Dispatch Template` subsections

~330 lines removed across 7 files. YAML files already contain this information.

### Change B: Added CONSTRAINTS Guards

Added `## CONSTRAINTS` section to all 7 .md files immediately after the Execution Protocol:
- Explicit `DO NOT dispatch` rules for each agent
- Clear statement that all dispatching is YAML-only
- `FIRST ACTION` directive to load YAML

### Change C: Restructured YAML Agent Sections

In all 11 YAML files (2 resume YAMLs have no agent routing):
- Renamed `agent_routing:` to `agent_availability:`
- Removed all `dispatch:` fields (the most trigger-prone field)
- Added `condition:` with explicit timing requirements
- Added `not_for:` with explicit anti-patterns
- Changed comment headers to "AGENT AVAILABILITY (conditional -- not instructions)"

## Files Changed

**Spec Kit MD (7):** `.opencode/command/spec_kit/{complete,implement,debug,handover,plan,research,resume}.md`

**Spec Kit YAML (11):** `.opencode/command/spec_kit/assets/spec_kit_{complete,implement,debug,plan,research}_{auto,confirm}.yaml` + `spec_kit_handover_full.yaml`

**Spec Folder (4):** `.opencode/specs/002-commands-and-skills/001-commands/010-speckit-codex-compatibility/{spec,plan,tasks,checklist}.md`

## Upgrade

No action required. `.claude/commands/spec_kit/` is a symlink to `.opencode/command/spec_kit/` so both locations are updated automatically.
